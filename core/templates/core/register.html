{% extends 'core/base.html' %}
{% load static %}

{% block title %}Registro - Ra√≠z Digital{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/variables.css' %}">

<!-- ‚ú® LIBRER√çAS PROFESIONALES PREMIUM ‚ú® -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>

<style>
    /* üé® VARIABLES DE DISE√ëO REFINADAS */
    :root {
        /* ‚ú® VERDE NE√ìN REFINADO - M√°s sutil y profesional */
        --neon-green: #00ff9d;
        --neon-green-subtle: #00e085;
        --neon-green-soft: rgba(0, 255, 157, 0.8);
        --neon-green-glow: rgba(0, 255, 157, 0.3);
        
        /* üé® GRADIENTES REFINADOS */
        --gradient-primary: linear-gradient(135deg, #00e085 0%, #00ff9d 100%);
        --gradient-secondary: linear-gradient(135deg, #4a90e2 0%, #667eea 100%);
        --gradient-accent: linear-gradient(135deg, #151718 0%, #030303 100%);
        --gradient-bg: linear-gradient(135deg, #0c0c26 0%, #1a1a3e 50%, #2d1b69 100%);
        
        --color-primary: #00ff9d;
        --color-secondary: #4a90e2;
        --color-accent: #667eea;
        --color-success: #00e085;
        --color-warning: #f0d969;
        --color-danger: #ec3e3e;
        
        --bg-glass: rgba(255, 255, 255, 0.08);
        --bg-glass-hover: rgba(255, 255, 255, 0.12);
        --border-glass: rgba(255, 255, 255, 0.15);
        --text-primary: #ffffff;
        --text-secondary: rgba(0, 255, 157, 0.8);
        --text-muted: rgba(255, 255, 255, 0.6);
        
        --shadow-glass: 0 8px 32px rgba(0, 0, 0, 0.3);
        --shadow-button: 0 4px 15px rgba(0, 255, 157, 0.3);
        --shadow-hover: 0 8px 25px rgba(0, 255, 157, 0.5);
        
        --radius-card: 24px;
        --radius-input: 16px;
        --radius-button: 12px;
        
        --font-heading: 'SF Pro Display', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
        --font-body: 'SF Pro Text', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    }

    /* üöÄ RESET Y BASE - OPTIMIZADO PARA SCROLL FLUIDO */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    /* üîß SCROLL ULTRA FLUIDO - OPTIMIZACI√ìN CR√çTICA */
    html {
        width: 100%;
        height: 100%;
        overflow-x: hidden;
        overflow-y: auto;
        scroll-behavior: smooth;
        /* üî• NUEVO: Optimizaciones anti-parpadeo */
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: none;
        /* üî• OPTIMIZACI√ìN GPU */
        transform: translateZ(0);
        will-change: scroll-position;
    }

    body {
        width: 100%;
        min-height: 100vh;
        height: auto;
        overflow-x: hidden;
        overflow-y: auto;
        font-family: var(--font-body);
        background: var(--gradient-bg);
        color: var(--text-primary);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        
        /* üî• NUEVO: Optimizaciones cr√≠ticas para fluidez */
        transform: translateZ(0);
        will-change: scroll-position;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        /* üî• PREVENIR PARPADEO EN SCROLL */
        perspective: 1000px;
        -webkit-perspective: 1000px;
    }

    /* üî• OPTIMIZACI√ìN DE ELEMENTOS ANIMADOS - SIN PARPADEO */
    .floating-elements {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        pointer-events: none;
        overflow: hidden;
        /* üî• NUEVO: Optimizaci√≥n GPU para elementos flotantes */
        transform: translateZ(0);
        will-change: transform;
        backface-visibility: hidden;
    }

    .floating-circle {
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.1; /* üî• REDUCIDO para menos distracci√≥n */
        animation: float 20s ease-in-out infinite; /* üî• M√ÅS LENTO para fluidez */
        /* üî• NUEVO: Optimizaciones GPU */
        transform: translateZ(0);
        will-change: transform;
        backface-visibility: hidden;
    }

    .floating-circle:nth-child(1) {
        width: 350px;
        height: 350px;
        background: var(--gradient-primary);
        top: -20%;
        left: -10%;
        animation-delay: 0s;
    }

    .floating-circle:nth-child(2) {
        width: 280px;
        height: 280px;
        background: var(--gradient-secondary);
        top: 50%;
        right: -15%;
        animation-delay: -7s;
    }

    .floating-circle:nth-child(3) {
        width: 220px;
        height: 220px;
        background: var(--gradient-accent);
        bottom: -10%;
        left: 30%;
        animation-delay: -14s;
    }

    /* üî• ANIMACI√ìN OPTIMIZADA - MENOS INTENSIVA */
    @keyframes float {
        0%, 100% { 
            transform: translateY(0px) translateX(0px) scale(1) translateZ(0); 
            opacity: 0.1;
        }
        25% { 
            transform: translateY(-15px) translateX(10px) scale(1.02) translateZ(0); 
            opacity: 0.15;
        }
        50% { 
            transform: translateY(-8px) translateX(-8px) scale(0.98) translateZ(0); 
            opacity: 0.2;
        }
        75% { 
            transform: translateY(-20px) translateX(15px) scale(1.03) translateZ(0); 
            opacity: 0.12;
        }
    }

    /* üèóÔ∏è LAYOUT PRINCIPAL - SCROLL √öNICO Y FLUIDO */
    .page-container {
        min-height: 100vh;
        width: 100%;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 2rem 1rem;
        position: relative;
        z-index: 10;
        
        /* üîß SCROLL √öNICO OPTIMIZADO */
        max-width: 450px;
        margin: 0 auto;
        /* üî• NUEVO: Optimizaci√≥n GPU */
        transform: translateZ(0);
        will-change: auto;
    }

    /* üé™ CONTENEDOR PRINCIPAL DEL FORMULARIO - OPTIMIZADO */
    .register-container {
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(25px);
        -webkit-backdrop-filter: blur(25px);
        border-radius: var(--radius-card);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 
            0 8px 32px rgba(0, 0, 0, 0.2),
            0 0 0 1px rgba(255, 255, 255, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.15);
        overflow: visible;
        position: relative;
        width: 100%;
        max-width: 360px;
        margin: 0 auto;
        height: auto;
        min-height: auto;
        
        /* üî• NUEVO: Optimizaci√≥n GPU */
        transform: translateZ(0);
        will-change: auto;
        backface-visibility: hidden;
    }

    /* üåà BORDE GRADIENTE ANIMADO - OPTIMIZADO */
    .register-border {
        position: absolute;
        inset: -1px;
        border-radius: calc(var(--radius-card) + 1px);
        background: linear-gradient(45deg, 
            rgba(255, 255, 255, 0.3), 
            rgba(0, 255, 157, 0.2), 
            rgba(255, 255, 255, 0.25),
            rgba(0, 255, 157, 0.15));
        background-size: 300% 300%;
        z-index: -1;
        animation: gradientRotate 20s ease-in-out infinite; /* üî• M√ÅS LENTO */
        opacity: 0.3; /* üî• M√ÅS SUTIL */
        /* üî• NUEVO: Optimizaci√≥n GPU */
        transform: translateZ(0);
        will-change: background-position;
    }

    @keyframes gradientRotate {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    /* üéØ CONTENIDO INTERNO - OPTIMIZADO */
    .register-content {
        position: relative;
        padding: 1.8rem 1.5rem;
        background: linear-gradient(145deg, 
            rgba(255, 255, 255, 0.1) 0%, 
            rgba(255, 255, 255, 0.05) 50%,
            rgba(255, 255, 255, 0.08) 100%);
        border-radius: calc(var(--radius-card) - 2px);
        /* üî• NUEVO: Optimizaci√≥n GPU */
        transform: translateZ(0);
    }

    .register-content::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, 
            transparent, 
            rgba(255, 255, 255, 0.4), 
            transparent);
        border-radius: var(--radius-card) var(--radius-card) 0 0;
    }

    /* üé≠ HEADER DEL FORMULARIO */
    .register-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    /* üî• √çCONO DE APP - OPTIMIZADO */
    .app-icon {
        width: 70px;
        height: 70px;
        background: var(--gradient-primary);
        border-radius: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.2rem;
        box-shadow: 
            var(--shadow-button),
            0 0 25px var(--neon-green-glow),
            inset 0 0 15px rgba(255, 255, 255, 0.1);
        border: 2px solid var(--neon-green);
        position: relative;
        overflow: hidden;
        /* üî• NUEVO: Optimizaci√≥n GPU */
        transform: translateZ(0);
        will-change: transform;
    }

    .app-icon::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transform: translateX(-100%) translateZ(0);
        animation: shimmer 6s ease-in-out infinite; /* üî• M√ÅS LENTO */
    }

    @keyframes shimmer {
        0% { transform: translateX(-100%) translateZ(0); }
        50% { transform: translateX(100%) translateZ(0); }
        100% { transform: translateX(100%) translateZ(0); }
    }

    .app-icon svg {
        width: 35px;
        height: 35px;
        fill: white;
        z-index: 1;
        filter: drop-shadow(0 0 6px rgba(255, 255, 255, 0.5));
        /* üî• NUEVO: Optimizaci√≥n GPU */
        transform: translateZ(0);
    }

    .register-title {
        font-family: var(--font-heading);
        font-size: 2rem;
        font-weight: 800;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 0.4rem;
        letter-spacing: -0.5px;
    }

    .register-subtitle {
        color: var(--text-secondary);
        font-size: 0.9rem;
        font-weight: 400;
    }

    /* üìù FORMULARIO */
    .register-form {
        display: flex;
        flex-direction: column;
        gap: 1.2rem;
    }

    /* üéØ GRUPOS DE CAMPOS */
    .form-group {
        position: relative;
    }

    .form-label {
        color: var(--text-primary);
        display: block;
        margin-bottom: 0.75rem;
        font-size: 0.875rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .form-label.required::after {
        content: ' *';
        color: var(--color-danger);
        margin-left: 2px;
    }

    /* üé™ INPUTS ESTILO CRYSTAL GLASSMORPHISM - OPTIMIZADOS */
    .input-wrapper {
        position: relative;
    }

    .form-input, .form-select {
        width: 100%;
        padding: 0.9rem 1rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: var(--radius-input);
        color: var(--text-primary);
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(15px);
        outline: none;
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1);
        /* üî• NUEVO: Optimizaci√≥n GPU */
        transform: translateZ(0);
        will-change: auto;
    }

    .form-input:focus, .form-select:focus {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(0, 255, 157, 0.5);
        box-shadow: 
            0 0 0 3px rgba(0, 255, 157, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
        transform: translateY(-1px) translateZ(0);
    }

    .form-input::placeholder {
        color: var(--text-muted);
    }

    /* üéØ SELECT PERSONALIZADO */
    .form-select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%2300ff9d' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 1rem center;
        background-size: 18px;
        cursor: pointer;
    }

    .form-select option {
        background: #1a1a3e;
        color: white;
        padding: 0.75rem;
    }

    /* üî• CAMPO FECHA - CORREGIDO PARA M√ìVIL */
    input[type="date"].form-input {
        color-scheme: dark;
        position: relative;
        /* üî• NUEVO: Padding especial para m√≥vil */
        padding-right: 2.5rem; /* Espacio extra para el √≠cono */
    }

    /* üî• √çCONO DEL CALENDARIO - OPTIMIZADO PARA M√ìVIL */
    input[type="date"].form-input::-webkit-calendar-picker-indicator {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='%2300ff9d'%3E%3Cpath d='M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z'/%3E%3C/svg%3E");
        background-size: 16px 16px;
        background-repeat: no-repeat;
        background-position: center;
        width: 24px; /* üî• M√ÅS GRANDE para m√≥vil */
        height: 24px; /* üî• M√ÅS GRANDE para m√≥vil */
        cursor: pointer;
        opacity: 0.8;
        transition: all 0.3s ease;
        filter: drop-shadow(0 0 4px rgba(0, 255, 157, 0.5));
        /* üî• NUEVO: Posici√≥n mejorada */
        position: absolute;
        right: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
    }

    input[type="date"].form-input::-webkit-calendar-picker-indicator:hover {
        opacity: 1;
        transform: translateY(-50%) scale(1.1);
        filter: drop-shadow(0 0 8px rgba(0, 255, 157, 0.8));
    }

    /* üî• ESPEC√çFICO PARA M√ìVIL - CAMPO FECHA */
    @media (max-width: 768px) {
        input[type="date"].form-input {
            padding-right: 3rem; /* üî• M√ÅS ESPACIO en m√≥vil */
            font-size: 16px; /* üî• PREVENIR ZOOM EN SAFARI */
        }
        
        input[type="date"].form-input::-webkit-calendar-picker-indicator {
            width: 28px; /* üî• A√öN M√ÅS GRANDE para m√≥vil */
            height: 28px;
            background-size: 20px 20px;
            right: 0.5rem;
        }
        
        /* üî• ALTERNATIVO para dispositivos que no soportan el √≠cono */
        input[type="date"].form-input::after {
            content: 'üìÖ';
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            pointer-events: none;
            color: var(--neon-green);
            display: none; /* Solo si el √≠cono CSS no funciona */
        }
    }

    /* üîß ALTERNATIVO PARA FIREFOX */
    input[type="date"].form-input::-moz-calendar-picker-indicator {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='%2300ff9d'%3E%3Cpath d='M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z'/%3E%3C/svg%3E");
        opacity: 0.8;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 24px;
        height: 24px;
    }

    /* üìù TEXTAREA */
    textarea.form-input {
        resize: vertical;
        min-height: 100px;
        font-family: inherit;
    }

    /* üöÄ BOT√ìN PRINCIPAL - OPTIMIZADO */
    .btn-submit {
        position: relative;
        width: 100%;
        padding: 1.1rem;
        background: linear-gradient(135deg,
            rgba(0, 255, 157, 0.8) 0%,
            rgba(0, 224, 133, 0.9) 100%);
        color: white;
        border: 1px solid rgba(0, 255, 157, 0.4);
        border-radius: var(--radius-button);
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 
            0 4px 15px rgba(0, 255, 157, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
        overflow: hidden;
        margin-top: 0.3rem;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        /* üî• NUEVO: Optimizaci√≥n GPU */
        transform: translateZ(0);
        will-change: transform;
    }

    .btn-submit::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, 
            transparent, 
            rgba(255, 255, 255, 0.2), 
            transparent);
        transition: left 0.6s ease;
        /* üî• NUEVO: Optimizaci√≥n GPU */
        transform: translateZ(0);
    }

    .btn-submit:hover, .btn-submit:active {
        transform: translateY(-2px) translateZ(0);
        background: linear-gradient(135deg,
            rgba(0, 255, 157, 0.9) 0%,
            rgba(0, 224, 133, 1) 100%);
        box-shadow: 
            0 8px 25px rgba(0, 255, 157, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }

    .btn-submit:hover::before {
        left: 100%;
    }

    .btn-submit.loading {
        color: transparent;
        pointer-events: none;
    }

    .btn-submit.loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) translateZ(0);
        width: 24px;
        height: 24px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top: 2px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: translate(-50%, -50%) rotate(0deg) translateZ(0); }
        100% { transform: translate(-50%, -50%) rotate(360deg) translateZ(0); }
    }

    /* üîô BOT√ìN DE REGRESO - OPTIMIZADO */
    .back-button {
        position: absolute;
        top: -80px;
        left: 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.875rem 1.25rem;
        background: var(--bg-glass);
        backdrop-filter: blur(10px);
        border: 1px solid var(--border-glass);
        border-radius: var(--radius-button);
        color: var(--text-primary);
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 600;
        transition: all 0.3s ease;
        z-index: 20;
        /* üî• NUEVO: Optimizaci√≥n GPU */
        transform: translateZ(0);
        will-change: transform;
    }

    .back-icon {
        width: 18px;
        height: 18px;
        fill: currentColor;
    }

    .back-button:hover {
        transform: translateY(-2px) translateZ(0);
        background: var(--bg-glass-hover);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        border-color: var(--neon-green-glow);
    }

    /* üé® MENSAJES DE ESTADO */
    .error-messages, .success-message {
        padding: 1.25rem;
        border-radius: var(--radius-input);
        margin-bottom: 1.5rem;
        backdrop-filter: blur(10px);
        border: 1px solid;
        animation: slideInUp 0.4s ease-out;
    }

    .error-messages {
        background: rgba(240, 65, 65, 0.1);
        border-color: rgba(240, 65, 65, 0.3);
        color: #fca5a5;
    }

    .success-message {
        background: rgba(0, 224, 133, 0.1);
        border-color: rgba(0, 224, 133, 0.3);
        color: var(--neon-green);
    }

    .error-messages ul {
        list-style: none;
        margin: 0;
        padding: 0;
    }

    .error-messages li {
        margin-bottom: 0.5rem;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .error-messages li::before {
        content: '‚ö†Ô∏è';
        font-size: 1rem;
    }

    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(20px) translateZ(0);
        }
        to {
            opacity: 1;
            transform: translateY(0) translateZ(0);
        }
    }

    /* üí° INFORMACI√ìN DE VERIFICACI√ìN - OPTIMIZADO */
    .verification-info {
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(0, 255, 157, 0.3);
        border-radius: var(--radius-input);
        padding: 1.2rem;
        margin-top: 1.2rem;
        font-size: 0.85rem;
        color: var(--text-primary);
        line-height: 1.5;
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(15px);
        box-shadow: 
            inset 0 1px 0 rgba(255, 255, 255, 0.1),
            0 2px 8px rgba(0, 255, 157, 0.1);
        /* üî• NUEVO: Optimizaci√≥n GPU */
        transform: translateZ(0);
    }

    .verification-info::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, 
            transparent, 
            rgba(0, 255, 157, 0.1), 
            transparent);
        animation: verificationScan 4s ease-in-out infinite; /* üî• M√ÅS LENTO */
        /* üî• NUEVO: Optimizaci√≥n GPU */
        transform: translateZ(0);
    }

    @keyframes verificationScan {
        0% { left: -100%; }
        50% { left: 100%; }
        100% { left: 100%; }
    }

    .verification-info strong {
        color: var(--neon-green);
        font-weight: 700;
        text-shadow: 0 0 10px var(--neon-green-glow);
        font-size: 1rem;
    }

    /* üîó ENLACES */
    .login-link {
        text-align: center;
        margin-top: 1.2rem;
        color: var(--text-secondary);
        font-size: 0.85rem;
    }

    .login-link a {
        color: var(--neon-green);
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        text-shadow: 0 0 5px var(--neon-green-glow);
    }

    .login-link a:hover {
        color: var(--neon-green-subtle);
        text-shadow: 0 0 10px var(--neon-green-glow);
    }

    /* üåü EFECTOS DE VALIDACI√ìN */
    .form-input.valid {
        border-color: var(--neon-green);
        box-shadow: 0 0 0 4px var(--neon-green-glow);
    }

    .form-input.invalid {
        border-color: var(--color-danger);
        box-shadow: 0 0 0 4px rgba(240, 65, 65, 0.2);
    }

    .input-effect {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: var(--gradient-primary);
        transform: scaleX(0) translateZ(0);
        transform-origin: center;
        transition: transform 0.3s ease;
        opacity: 0;
        border-radius: 1px;
    }

    .form-input:focus + .input-effect {
        opacity: 1;
        transform: scaleX(1) translateZ(0);
    }

    /* üì± RESPONSIVE DESIGN - SCROLL FLUIDO OPTIMIZADO */
    
    /* M√≥vil - SCROLL PRINCIPAL ULTRA FLUIDO */
    @media (max-width: 480px) {
        /* üî• OPTIMIZACIONES CR√çTICAS PARA SCROLL FLUIDO EN M√ìVIL */
        html {
            overflow-y: auto !important;
            overflow-x: hidden !important;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: none;
            /* üî• NUEVO: Optimizaciones espec√≠ficas iOS/Android */
            -webkit-transform: translateZ(0);
            -moz-transform: translateZ(0);
            -ms-transform: translateZ(0);
            transform: translateZ(0);
        }

        body {
            overflow-y: auto !important;
            overflow-x: hidden !important;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            touch-action: manipulation;
            /* üî• PREVENIR REBOTE Y PARPADEO */
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: none;
            overscroll-behavior-y: none;
            position: relative;
            /* üî• OPTIMIZACI√ìN GPU M√ìVIL */
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
            will-change: scroll-position;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        .page-container {
            padding: 1rem 0.5rem;
            min-height: 100vh;
            height: auto;
            align-items: flex-start;
            padding-top: 2rem;
            padding-bottom: 3rem; /* üî• M√ÅS ESPACIO abajo */
            /* üî• OPTIMIZACI√ìN GPU */
            transform: translateZ(0);
            will-change: auto;
        }

        .register-container {
            max-width: 100%;
            width: 100%;
            border-radius: 16px;
            height: auto;
            margin: 0;
            /* üî• OPTIMIZACI√ìN GPU */
            transform: translateZ(0);
        }

        .register-content {
            padding: 1.5rem 1rem;
        }

        .app-icon {
            width: 60px;
            height: 60px;
            margin-bottom: 1rem;
        }

        .app-icon svg {
            width: 30px;
            height: 30px;
        }

        .register-title {
            font-size: 1.8rem;
        }

        .register-subtitle {
            font-size: 0.85rem;
        }

        .form-input, .form-select {
            padding: 0.9rem;
            font-size: 16px; /* üî• PREVENIR ZOOM EN SAFARI M√ìVIL */
        }

        .btn-submit {
            padding: 1rem;
            font-size: 0.95rem;
        }

        .back-button {
            top: -60px;
            padding: 0.6rem 0.8rem;
            font-size: 0.75rem;
        }

        /* üî• OPTIMIZACI√ìN DE CAMPOS SIN ANIMACIONES DISRUPTIVAS */
        .form-input:focus, .form-select:focus {
            transform: translateY(-1px) translateZ(0);
        }

        .register-form {
            gap: 1rem;
        }

        .verification-info {
            padding: 1rem;
            margin-top: 1rem;
            margin-bottom: 1rem;
            font-size: 0.8rem;
        }

        .login-link {
            margin-top: 1rem;
            margin-bottom: 2rem;
        }

        /* üî• ESPEC√çFICO PARA CAMPO FECHA EN M√ìVIL */
        .form-group:has(input[type="date"]) .form-label::after {
            content: " (Toca el √≠cono del calendario)";
            font-size: 0.7rem;
            color: var(--text-muted);
            font-weight: normal;
            text-transform: none;
        }

        /* üî• ANIMACIONES SIMPLIFICADAS EN M√ìVIL */
        .floating-circle {
            animation-duration: 25s; /* M√°s lento en m√≥vil */
            opacity: 0.05; /* M√°s sutil en m√≥vil */
        }

        .register-border {
            animation-duration: 25s; /* M√°s lento en m√≥vil */
            opacity: 0.2; /* M√°s sutil en m√≥vil */
        }
    }

    /* Tablet y Desktop - SCROLL FLUIDO */
    @media (min-width: 481px) {
        .page-container {
            padding: 3rem 1.5rem;
            min-height: 100vh;
            height: auto;
            max-width: 450px;
            margin: 0 auto;
            align-items: flex-start;
            justify-content: center;
            padding-top: 4rem;
            padding-bottom: 4rem;
        }
        
        .register-container {
            max-width: 360px;
            height: auto;
        }
        
        .register-content {
            padding: 1.8rem 1.5rem;
        }

        .register-header {
            margin-bottom: 1.5rem;
        }

        .register-form {
            gap: 1rem;
        }
    }

    /* Desktop extra grande */
    @media (min-width: 1200px) {
        .page-container {
            max-width: 450px;
            padding: 4rem 2rem;
            padding-top: 5rem;
            padding-bottom: 5rem;
        }

        .register-container {
            max-width: 360px;
        }
    }

    /* üé≠ ANIMACIONES DE ENTRADA - OPTIMIZADAS */
    .form-group {
        animation: fadeInUp 0.6s ease-out backwards;
        /* üî• OPTIMIZACI√ìN GPU */
        transform: translateZ(0);
        will-change: transform, opacity;
    }

    .form-group:nth-child(1) { animation-delay: 0.1s; }
    .form-group:nth-child(2) { animation-delay: 0.15s; }
    .form-group:nth-child(3) { animation-delay: 0.2s; }
    .form-group:nth-child(4) { animation-delay: 0.25s; }
    .form-group:nth-child(5) { animation-delay: 0.3s; }
    .form-group:nth-child(6) { animation-delay: 0.35s; }
    .form-group:nth-child(7) { animation-delay: 0.4s; }
    .form-group:nth-child(8) { animation-delay: 0.45s; }
    .form-group:nth-child(9) { animation-delay: 0.5s; }
    .form-group:nth-child(10) { animation-delay: 0.55s; }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px) translateZ(0);
        }
        to {
            opacity: 1;
            transform: translateY(0) translateZ(0);
        }
    }

    /* üî• EFECTOS HOVER OPTIMIZADOS */
    @media (hover: hover) and (pointer: fine) {
        .form-group:hover .form-input:not(:focus) {
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.15);
            transform: translateZ(0);
        }
    }

    /* üé™ MICRO-INTERACCIONES - OPTIMIZADAS PARA M√ìVIL */
    .form-input:focus {
        animation: none; /* üî• DESACTIVAR ANIMACIONES EN M√ìVIL */
    }

    @media (hover: hover) and (pointer: fine) {
        .form-input:focus {
            animation: focusPulse 0.3s ease-out;
        }
    }

    @keyframes focusPulse {
        0% { transform: scale(1) translateZ(0); }
        50% { transform: scale(1.01) translateZ(0); }
        100% { transform: scale(1) translateZ(0); }
    }

    /* üéØ ANIMACI√ìN ESPECIAL PARA EL √çCONO - OPTIMIZADA */
    .app-icon {
        animation: iconFloat 8s ease-in-out infinite; /* üî• M√ÅS LENTO */
    }

    @keyframes iconFloat {
        0%, 100% { 
            transform: translateY(0px) rotate(0deg) translateZ(0);
            box-shadow: 
                var(--shadow-button),
                0 0 30px var(--neon-green-glow),
                inset 0 0 20px rgba(255, 255, 255, 0.1);
        }
        50% { 
            transform: translateY(-5px) rotate(2deg) translateZ(0);
            box-shadow: 
                var(--shadow-hover),
                0 0 40px var(--neon-green-glow),
                inset 0 0 25px rgba(255, 255, 255, 0.15);
        }
    }

    /* üî• OPTIMIZACIONES CR√çTICAS PARA PREVENIR PARPADEO */
    @media (prefers-reduced-motion: reduce) {
        .floating-circle,
        .register-border,
        .app-icon,
        .verification-info::before {
            animation: none !important;
        }
        
        .form-input:focus {
            transform: none !important;
        }
        
        .btn-submit:hover {
            transform: none !important;
        }
    }

    /* üî• FORZAR ACELERACI√ìN GPU EN TODOS LOS ELEMENTOS PRINCIPALES */
    .page-container,
    .register-container,
    .register-content,
    .form-group,
    .form-input,
    .form-select,
    .btn-submit,
    .back-button {
        -webkit-transform: translateZ(0);
        -moz-transform: translateZ(0);
        -ms-transform: translateZ(0);
        transform: translateZ(0);
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        -webkit-perspective: 1000;
        perspective: 1000;
    }

    /* üî• ESPEC√çFICO PARA WEBKIT (Safari/Chrome) */
    @supports (-webkit-appearance: none) {
        input[type="date"].form-input::-webkit-calendar-picker-indicator {
            background-color: transparent;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='%2300ff9d'%3E%3Cpath d='M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: center;
            background-size: 18px;
            cursor: pointer;
            opacity: 0.9;
            transition: all 0.3s ease;
            filter: drop-shadow(0 0 4px rgba(0, 255, 157, 0.6));
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- üåà ELEMENTOS FLOTANTES DE FONDO -->
<div class="floating-elements">
    <div class="floating-circle"></div>
    <div class="floating-circle"></div>
    <div class="floating-circle"></div>
</div>

<div class="page-container">
    <div class="register-container">
        <!-- Bot√≥n volver -->
        <a href="{% url 'core:login' %}" class="back-button">
            <svg class="back-icon" viewBox="0 0 24 24">
                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
            </svg>
            <span>Volver al Login</span>
        </a>

        <div class="register-border"></div>
        <div class="register-content">
            <!-- Header con √≠cono de app verde ne√≥n -->
            <div class="register-header">
                <div class="app-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"/>
                        <path d="M12 4.5c-4.136 0-7.5 3.364-7.5 7.5s3.364 7.5 7.5 7.5 7.5-3.364 7.5-7.5-3.364-7.5-7.5-7.5zm0 14c-3.584 0-6.5-2.916-6.5-6.5s2.916-6.5 6.5-6.5 6.5 2.916 6.5 6.5-2.916 6.5-6.5 6.5z"/>
                        <circle cx="12" cy="12" r="2.5"/>
                    </svg>
                </div>
                <h2 class="register-title">Crear Cuenta</h2>
                <p class="register-subtitle">√önete a la comunidad digital de tradiciones</p>
            </div>

            <!-- MENSAJES DE ERROR Y √âXITO -->
            {% if errors %}
            <div class="error-messages">
                <ul>
                    {% for error in errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if messages %}
                {% for message in messages %}
                    {% if message.tags == 'success' %}
                        <div class="success-message">
                            {{ message }}
                        </div>
                    {% endif %}
                {% endfor %}
            {% endif %}

            <form class="register-form" method="post" action="{% url 'core:register' %}" novalidate>
                {% csrf_token %}
                
                <!-- Nombre -->
                <div class="form-group">
                    <label class="form-label required">Nombre</label>
                    <div class="input-wrapper">
                        <input type="text" class="form-input" name="nombre" 
                               value="{{ form_data.nombre|default:'' }}" 
                               placeholder="Tu nombre" required>
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Apellido -->
                <div class="form-group">
                    <label class="form-label required">Apellido</label>
                    <div class="input-wrapper">
                        <input type="text" class="form-input" name="apellido" 
                               value="{{ form_data.apellido|default:'' }}" 
                               placeholder="Tu apellido" required>
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Usuario -->
                <div class="form-group">
                    <label class="form-label required">Usuario</label>
                    <div class="input-wrapper">
                        <input type="text" class="form-input" name="username" 
                               value="{{ form_data.username|default:'' }}" 
                               placeholder="Nombre de usuario √∫nico" required>
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Email -->
                <div class="form-group">
                    <label class="form-label required">Email</label>
                    <div class="input-wrapper">
                        <input type="email" class="form-input" name="email" 
                               value="{{ form_data.email|default:'' }}" 
                               placeholder="tu@email.com" required>
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Contrase√±a -->
                <div class="form-group">
                    <label class="form-label required">Contrase√±a</label>
                    <div class="input-wrapper">
                        <input type="password" class="form-input" name="password" 
                               placeholder="M√≠nimo 8 caracteres" required>
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Confirmar Contrase√±a -->
                <div class="form-group">
                    <label class="form-label required">Confirmar Contrase√±a</label>
                    <div class="input-wrapper">
                        <input type="password" class="form-input" name="password_confirm" 
                               placeholder="Repite tu contrase√±a" required>
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Fecha de Nacimiento -->
                <div class="form-group">
                    <label class="form-label">Fecha de Nacimiento</label>
                    <div class="input-wrapper">
                        <input type="date" class="form-input" name="fecha_nacimiento"
                               value="{{ form_data.fecha_nacimiento|default:'' }}">
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Tel√©fono -->
                <div class="form-group">
                    <label class="form-label">Tel√©fono</label>
                    <div class="input-wrapper">
                        <input type="tel" class="form-input" name="telefono" 
                               value="{{ form_data.telefono|default:'' }}" 
                               placeholder="+57 300 123 4567">
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Comunidad -->
                <div class="form-group">
                    <label class="form-label required">Comunidad</label>
                    <div class="input-wrapper">
                        <select class="form-select" name="id_comunidad" required>
                            <option value="">Selecciona tu comunidad</option>
                            {% for comunidad in comunidades %}
                            <option value="{{ comunidad.id }}" 
                                    {% if form_data.id_comunidad|default:'' == comunidad.id|stringformat:"s" %}selected{% endif %}>
                                {{ comunidad.display_name }}
                            </option>
                            {% endfor %}
                            {% if not comunidades %}
                            <option value="" disabled>No hay comunidades disponibles</option>
                            {% endif %}
                        </select>
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Direcci√≥n -->
                <div class="form-group">
                    <label class="form-label">Direcci√≥n</label>
                    <div class="input-wrapper">
                        <input type="text" class="form-input" name="direccion" 
                               value="{{ form_data.direccion|default:'' }}" 
                               placeholder="Tu direcci√≥n (opcional)">
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Biograf√≠a -->
                <div class="form-group">
                    <label class="form-label">Cu√©ntanos sobre ti</label>
                    <div class="input-wrapper">
                        <textarea class="form-input" name="biografia" rows="3" 
                                  placeholder="Breve descripci√≥n sobre ti y tus intereses en las tradiciones (opcional)">{{ form_data.biografia|default:'' }}</textarea>
                        <div class="input-effect"></div>
                    </div>
                </div>

                <button type="submit" class="btn-submit">
                    <span>Crear Mi Cuenta</span>
                </button>
            </form>

            <div class="verification-info">
                <strong>üìß Verificaci√≥n de Email:</strong><br>
                Despu√©s del registro, enviaremos un email de verificaci√≥n a tu correo. 
                Debes verificar tu cuenta para poder acceder completamente a la plataforma.
            </div>

            <div class="login-link">
                ¬øYa tienes una cuenta? <a href="{% url 'core:login' %}">Inicia sesi√≥n aqu√≠</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'core/js/digital-effects.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Iniciando Registro Ultra Fluido - Optimizado');
    
    // ========================================
    // üî• OPTIMIZACIONES CR√çTICAS PARA SCROLL FLUIDO
    // ========================================
    
    // Prevenir rebote en iOS y Android
    let isScrolling = false;
    let scrollTimeout;

    function optimizeScrollPerformance() {
        // Throttle scroll events para mejor rendimiento
        if (!isScrolling) {
            window.requestAnimationFrame(function() {
                // Operaciones durante el scroll
                isScrolling = false;
            });
            isScrolling = true;
        }

        // Clear timeout y set nuevo
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(function() {
            // Scroll terminado - optimizaciones post-scroll
            document.body.style.transform = 'translateZ(0)';
        }, 150);
    }

    // Aplicar listener de scroll optimizado
    window.addEventListener('scroll', optimizeScrollPerformance, { passive: true });

    // Prevenir zoom accidental en m√≥vil
    if ('ontouchstart' in window) {
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                const target = event.target;
                if (!target.closest('input, button, select, textarea, a')) {
                    event.preventDefault();
                }
            }
            lastTouchEnd = now;
        }, { passive: false });
    }

    // ========================================
    // INICIALIZACI√ìN AOS Y GSAP - OPTIMIZADA
    // ========================================
    if (typeof AOS !== 'undefined') {
        AOS.init({
            duration: 600, // üî• M√ÅS R√ÅPIDO para fluidez
            easing: 'ease-out-cubic',
            once: true,
            offset: 30, // üî• MENOR offset para mejor timing
            disable: window.innerWidth <= 768 // üî• DESACTIVAR en m√≥vil
        });
    }

    // ========================================
    // ANIMACIONES GSAP - ULTRA OPTIMIZADAS
    // ========================================
    if (typeof gsap !== 'undefined') {
        // üî• CONFIGURACI√ìN OPTIMIZADA DE GSAP
        gsap.config({
            force3D: true,
            nullTargetWarn: false
        });

        // Animaci√≥n del contenedor principal - m√°s sutil
        gsap.fromTo('.register-container', 
            {
                scale: 0.98,
                opacity: 0,
                y: 20
            },
            {
                scale: 1,
                opacity: 1,
                y: 0,
                duration: 0.6, // üî• M√ÅS R√ÅPIDO
                ease: "power2.out",
                force3D: true
            }
        );

        // Animaciones de elementos flotantes - M√ÅS LENTAS y SUTILES
        gsap.to('.floating-circle:nth-child(1)', {
            rotation: 360,
            duration: 30, // üî• M√ÅS LENTO
            repeat: -1,
            ease: "none",
            force3D: true
        });

        gsap.to('.floating-circle:nth-child(2)', {
            rotation: -360,
            duration: 35, // üî• M√ÅS LENTO
            repeat: -1,
            ease: "none",
            force3D: true
        });

        gsap.to('.floating-circle:nth-child(3)', {
            rotation: 360,
            duration: 40, // üî• M√ÅS LENTO
            repeat: -1,
            ease: "none",
            force3D: true
        });

        // Animaci√≥n del √≠cono - m√°s sutil
        gsap.to('.app-icon', {
            rotationY: 360,
            duration: 12, // üî• M√ÅS LENTO
            repeat: -1,
            ease: "power1.inOut",
            yoyo: true,
            force3D: true
        });

        // Pulso del borde - m√°s sutil
        gsap.to('.register-border', {
            opacity: 0.4, // üî• M√ÅS SUTIL
            duration: 3, // üî• M√ÅS LENTO
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut",
            force3D: true
        });
    }

    // ========================================
    // EFECTOS DE FORMULARIO - OPTIMIZADOS
    // ========================================
    const form = document.querySelector('.register-form');
    const inputs = form.querySelectorAll('.form-input, .form-select');
    const submitBtn = form.querySelector('.btn-submit');

    // Efectos de interacci√≥n m√°s suaves
    inputs.forEach((input, index) => {
        // Efecto de focus SOLO en desktop
        if (window.innerWidth > 768) {
            input.addEventListener('focus', function() {
                if (typeof gsap !== 'undefined') {
                    gsap.to(this.parentElement.parentElement, {
                        scale: 1.005, // üî• M√ÅS SUTIL
                        duration: 0.15, // üî• M√ÅS R√ÅPIDO
                        ease: "power1.out",
                        force3D: true
                    });
                }
            });

            input.addEventListener('blur', function() {
                if (typeof gsap !== 'undefined') {
                    gsap.to(this.parentElement.parentElement, {
                        scale: 1,
                        duration: 0.15,
                        ease: "power1.out",
                        force3D: true
                    });
                }
            });
        }

        // Validaci√≥n en tiempo real
        input.addEventListener('input', function() {
            validateField(this);
        });
    });

    // ========================================
    // üî• OPTIMIZACI√ìN ESPEC√çFICA PARA CAMPO FECHA
    // ========================================
    const dateInput = document.querySelector('input[type="date"]');
    if (dateInput) {
        // Agregar indicador visual adicional en m√≥vil
        if (window.innerWidth <= 768) {
            const dateLabel = dateInput.closest('.form-group').querySelector('.form-label');
            if (dateLabel && !dateLabel.textContent.includes('calendario')) {
                const helpText = document.createElement('small');
                helpText.style.cssText = `
                    display: block;
                    color: var(--text-muted);
                    font-size: 0.7rem;
                    margin-top: 0.25rem;
                    font-weight: normal;
                `;
                helpText.textContent = 'üìÖ Toca el √≠cono del calendario para seleccionar';
                dateLabel.parentNode.insertBefore(helpText, dateInput.parentNode);
            }
        }

        // Mejorar experiencia de usuario
        dateInput.addEventListener('focus', function() {
            console.log('üìÖ Campo fecha enfocado');
        });

        dateInput.addEventListener('change', function() {
            console.log('üìÖ Fecha seleccionada:', this.value);
            if (this.value) {
                this.classList.add('valid');
            }
        });
    }

    // ========================================
    // VALIDACI√ìN OPTIMIZADA
    // ========================================

    // Validaci√≥n de contrase√±as
    const passwordInput = document.querySelector('input[name="password"]');
    const confirmPasswordInput = document.querySelector('input[name="password_confirm"]');

    function validatePassword() {
        if (!passwordInput || !confirmPasswordInput) return true;
        
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        
        // Remover clases de error previas
        passwordInput.classList.remove('field-error', 'invalid', 'valid');
        confirmPasswordInput.classList.remove('field-error', 'invalid', 'valid');
        
        // Validar longitud m√≠nima
        if (password.length > 0 && password.length < 8) {
            passwordInput.classList.add('field-error', 'invalid');
            return false;
        } else if (password.length >= 8) {
            passwordInput.classList.add('valid');
        }
        
        // Validar coincidencia de contrase√±as
        if (confirmPassword.length > 0 && password !== confirmPassword) {
            confirmPasswordInput.classList.add('field-error', 'invalid');
            return false;
        } else if (confirmPassword.length > 0 && password === confirmPassword) {
            confirmPasswordInput.classList.add('valid');
        }
        
        return true;
    }

    // Validaci√≥n de email
    const emailInput = document.querySelector('input[name="email"]');
    function validateEmail() {
        if (!emailInput) return true;
        
        const email = emailInput.value;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        
        emailInput.classList.remove('field-error', 'invalid', 'valid');
        
        if (email.length > 0 && !emailRegex.test(email)) {
            emailInput.classList.add('field-error', 'invalid');
            return false;
        } else if (email.length > 0 && emailRegex.test(email)) {
            emailInput.classList.add('valid');
        }
        
        return true;
    }

    // Validaci√≥n de username
    const usernameInput = document.querySelector('input[name="username"]');
    function validateUsername() {
        if (!usernameInput) return true;
        
        const username = usernameInput.value;
        const usernameRegex = /^[a-zA-Z0-9_]+$/;
        
        usernameInput.classList.remove('field-error', 'invalid', 'valid');
        
        if (username.length > 0 && (!usernameRegex.test(username) || username.length < 3)) {
            usernameInput.classList.add('field-error', 'invalid');
            return false;
        } else if (username.length >= 3 && usernameRegex.test(username)) {
            usernameInput.classList.add('valid');
        }
        
        return true;
    }

    // Event listeners para validaci√≥n en tiempo real
    if (passwordInput && confirmPasswordInput) {
        passwordInput.addEventListener('input', validatePassword);
        confirmPasswordInput.addEventListener('input', validatePassword);
    }

    if (emailInput) {
        emailInput.addEventListener('input', validateEmail);
    }

    if (usernameInput) {
        usernameInput.addEventListener('input', validateUsername);
    }

    // ========================================
    // VALIDACI√ìN UNIVERSAL DE CAMPOS
    // ========================================
    
    function validateField(field) {
        const value = field.value.trim();
        const fieldName = field.name;
        let isValid = true;

        // Remover clases previas
        field.classList.remove('valid', 'invalid', 'field-error');

        if (value.length === 0) {
            // Campo vac√≠o - no mostrar validaci√≥n
            return true;
        }

        switch(fieldName) {
            case 'nombre':
            case 'apellido':
                isValid = value.length >= 2;
                break;
            case 'username':
                isValid = value.length >= 3 && /^[a-zA-Z0-9_]+$/.test(value);
                break;
            case 'email':
                isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
                break;
            case 'password':
                isValid = value.length >= 8;
                break;
            case 'password_confirm':
                const password = document.querySelector('input[name="password"]').value;
                isValid = value === password;
                break;
        }

        // Aplicar clases de validaci√≥n
        if (isValid) {
            field.classList.add('valid');
            // Efecto de √©xito verde ne√≥n - SOLO en desktop
            if (typeof gsap !== 'undefined' && window.innerWidth > 768) {
                gsap.fromTo(field, 
                    { borderColor: '#00ff9d' },
                    { borderColor: '#00ff9d', duration: 0.2, ease: "power1.out" }
                );
            }
        } else {
            field.classList.add('invalid');
            // Efecto de error - SOLO en desktop
            if (typeof gsap !== 'undefined' && window.innerWidth > 768) {
                gsap.fromTo(field, 
                    { x: -2 },
                    { x: 2, duration: 0.1, repeat: 1, yoyo: true, ease: "power1.out" }
                );
            }
        }

        return isValid;
    }

    // ========================================
    // MANEJO DEL ENV√çO DEL FORMULARIO
    // ========================================
    
    if (form) {
        form.addEventListener('submit', function(e) {
            console.log('üìù Enviando formulario de registro...');
            
            // Validar todos los campos antes del env√≠o
            const isPasswordValid = validatePassword();
            const isEmailValid = validateEmail();
            const isUsernameValid = validateUsername();
            
            if (!isPasswordValid || !isEmailValid || !isUsernameValid) {
                e.preventDefault();
                console.log('‚ùå Formulario inv√°lido, evitando env√≠o');
                showNotification('Por favor, corrige los errores en el formulario', 'error');
                return;
            }
            
            // Verificar que los campos requeridos est√©n llenos
            const requiredFields = form.querySelectorAll('input[required], select[required]');
            let allFieldsValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('field-error', 'invalid');
                    allFieldsValid = false;
                }
            });
            
            if (!allFieldsValid) {
                e.preventDefault();
                showNotification('Todos los campos marcados con * son obligatorios', 'error');
                return;
            }
            
            // A√±adir clase de loading al bot√≥n
            if (submitBtn) {
                submitBtn.classList.add('loading');
                submitBtn.disabled = true;
                
                // Animaci√≥n m√°s sutil en m√≥vil
                if (typeof gsap !== 'undefined' && window.innerWidth > 768) {
                    gsap.to(submitBtn, {
                        scale: 0.98,
                        duration: 0.1,
                        yoyo: true,
                        repeat: 1,
                        force3D: true
                    });
                }
            }
            
            console.log('‚úÖ Formulario v√°lido, enviando...');
        });
    }

    // ========================================
    // SISTEMA DE NOTIFICACIONES OPTIMIZADO
    // ========================================

    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <div class="notification-icon">${getNotificationIcon(type)}</div>
                <span>${message}</span>
            </div>
        `;
        
        notification.style.cssText = `
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 16px;
            font-weight: 600;
            z-index: 9999;
            max-width: 400px;
            min-width: 300px;
            backdrop-filter: blur(20px);
            border: 1px solid;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transform: translateX(100%) translateZ(0);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        `;
        
        // Estilos seg√∫n el tipo
        if (type === 'error') {
            notification.style.background = 'rgba(240, 65, 65, 0.9)';
            notification.style.color = 'white';
            notification.style.borderColor = '#f04141';
        } else if (type === 'success') {
            notification.style.background = 'rgba(0, 224, 133, 0.9)';
            notification.style.color = 'white';
            notification.style.borderColor = '#00ff9d';
            notification.style.boxShadow = '0 10px 40px rgba(0, 255, 157, 0.3)';
        } else {
            notification.style.background = 'rgba(0, 255, 157, 0.9)';
            notification.style.color = 'white';
            notification.style.borderColor = '#00ff9d';
        }
        
        // Ajustar para m√≥vil
        if (window.innerWidth <= 768) {
            notification.style.top = '1rem';
            notification.style.right = '1rem';
            notification.style.left = '1rem';
            notification.style.maxWidth = 'none';
            notification.style.minWidth = 'auto';
        }
        
        document.body.appendChild(notification);
        
        // Mostrar con animaci√≥n
        setTimeout(() => {
            notification.style.transform = 'translateX(0) translateZ(0)';
        }, 100);
        
        // Ocultar despu√©s de 4 segundos
        setTimeout(() => {
            notification.style.transform = 'translateX(100%) translateZ(0)';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 400);
        }, 4000);
    }

    function getNotificationIcon(type) {
        switch(type) {
            case 'error': return '‚ö†Ô∏è';
            case 'success': return '‚úÖ';
            default: return 'üíö';
        }
    }

    // ========================================
    // EFECTOS DE PART√çCULAS DE √âXITO - OPTIMIZADOS
    // ========================================

    if (document.querySelector('.success-message')) {
        createSuccessParticles();
    }

    function createSuccessParticles() {
        // Menos part√≠culas en m√≥vil
        const particleCount = window.innerWidth <= 768 ? 8 : 15;
        
        for (let i = 0; i < particleCount; i++) {
            setTimeout(() => {
                const particle = document.createElement('div');
                particle.style.cssText = `
                    position: fixed;
                    width: 4px;
                    height: 4px;
                    background: linear-gradient(135deg, #00ff9d, #00e085);
                    border-radius: 50%;
                    pointer-events: none;
                    z-index: 9999;
                    box-shadow: 0 0 6px rgba(0, 255, 157, 0.6);
                    left: ${Math.random() * window.innerWidth}px;
                    top: ${window.innerHeight}px;
                    animation: floatUp 3s ease-out forwards;
                    transform: translateZ(0);
                `;
                
                document.body.appendChild(particle);
                
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.remove();
                    }
                }, 3000);
            }, i * 80);
        }
    }

    // ========================================
    // EFECTOS ESPECIALES PARA VERIFICACI√ìN - OPTIMIZADOS
    // ========================================
    
    const verificationInfo = document.querySelector('.verification-info');
    if (verificationInfo && typeof gsap !== 'undefined' && window.innerWidth > 768) {
        // Pulso muy sutil solo en desktop
        gsap.to(verificationInfo, {
            boxShadow: "0 0 15px rgba(0, 255, 157, 0.3)",
            duration: 4,
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut",
            force3D: true
        });
    }

    // ========================================
    // üî• OPTIMIZACIONES FINALES PARA FLUIDEZ
    // ========================================

    // Optimizar elementos despu√©s de carga completa
    window.addEventListener('load', function() {
        // Forzar repaint inicial
        document.body.style.transform = 'translateZ(0)';
        
        // Optimizar todos los elementos principales
        const mainElements = document.querySelectorAll('.page-container, .register-container, .form-group');
        mainElements.forEach(el => {
            el.style.transform = 'translateZ(0)';
            el.style.backfaceVisibility = 'hidden';
        });
        
        console.log('üî• Optimizaciones de fluidez aplicadas');
    });

    // Optimizar en cambio de orientaci√≥n m√≥vil
    window.addEventListener('orientationchange', function() {
        setTimeout(() => {
            // Re-optimizar despu√©s del cambio
            document.body.style.transform = 'translateZ(0)';
            
            // Ajustar notificaciones si existen
            const notifications = document.querySelectorAll('.notification');
            notifications.forEach(notif => {
                if (window.innerWidth <= 768) {
                    notif.style.left = '1rem';
                    notif.style.right = '1rem';
                    notif.style.maxWidth = 'none';
                }
            });
        }, 200);
    });

    // Optimizar scroll en dispositivos t√°ctiles
    if ('ontouchstart' in window) {
        let touchStartY = 0;
        
        document.addEventListener('touchstart', function(e) {
            touchStartY = e.touches[0].clientY;
        }, { passive: true });
        
        document.addEventListener('touchmove', function(e) {
            // Optimizar rendimiento durante scroll t√°ctil
            const touchY = e.touches[0].clientY;
            const deltaY = touchY - touchStartY;
            
            // Aplicar optimizaciones durante scroll
            if (Math.abs(deltaY) > 10) {
                document.body.style.willChange = 'scroll-position';
            }
        }, { passive: true });
        
        document.addEventListener('touchend', function() {
            // Limpiar optimizaciones despu√©s del scroll
            setTimeout(() => {
                document.body.style.willChange = 'auto';
            }, 100);
        }, { passive: true });
    }

    console.log('‚ú® Registro Ultra Fluido - Optimizado y listo');
});

// ========================================
// CSS ADICIONAL PARA ANIMACIONES Y FLUIDEZ
// ========================================

const additionalCSS = `
    @keyframes floatUp {
        0% {
            transform: translateY(0) rotate(0deg) translateZ(0);
            opacity: 0.8;
        }
        50% {
            opacity: 1;
        }
        100% {
            transform: translateY(-100vh) rotate(360deg) translateZ(0);
            opacity: 0;
        }
    }

    /* üî• Optimizaciones cr√≠ticas para m√≥vil */
    @media (max-width: 480px) {
        /* Prevenir scroll horizontal */
        * {
            max-width: 100vw !important;
        }
        
        /* Optimizar animaciones en m√≥vil */
        .floating-circle {
            animation-duration: 30s !important;
            opacity: 0.03 !important;
        }
        
        .register-border {
            animation-duration: 30s !important;
            opacity: 0.15 !important;
        }
        
        /* Optimizar efectos de focus en m√≥vil */
        .form-input:focus,
        .form-select:focus {
            transform: none !important;
            animation: none !important;
        }
    }

    /* üî• Forzar aceleraci√≥n GPU en elementos cr√≠ticos */
    .page-container,
    .register-container,
    .register-content,
    .floating-elements,
    .floating-circle {
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        -webkit-perspective: 1000px;
        perspective: 1000px;
    }

    /* üî• Optimizaciones para reducir reflows */
    .form-input,
    .form-select,
    .btn-submit {
        contain: layout style paint;
    }

    /* üî• Optimizar transiciones */
    .form-input,
    .form-select {
        transition: border-color 0.2s ease, 
                   background-color 0.2s ease,
                   box-shadow 0.2s ease,
                   transform 0.2s ease;
    }
`;

const style = document.createElement('style');
style.textContent = additionalCSS;
document.head.appendChild(style);
</script>

{% if success %}
{% include 'core/includes/success_modal.html' %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const userData = {
        username: '{{ form_data.username|default:"" }}',
        email: '{{ form_data.email|default:"" }}'
    };
    
    // Mostrar el modal autom√°ticamente
    if (window.showEpicSuccessModal) {
        window.showEpicSuccessModal({
            title: "¬°REGISTRO EXITOSO!",
            subtitle: "Bienvenido a Ra√≠z Digital",
            message: "Tu cuenta ha sido creada exitosamente para " + userData.username + ".",
            verificationText: "Hemos enviado un enlace de verificaci√≥n a " + userData.email + ". Por favor revisa tu bandeja de entrada."
        });
    }
});
</script>
{% endif %}
{% endblock %}