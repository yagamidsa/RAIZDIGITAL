{% extends 'core/base.html' %}
{% load static %}

{% block title %}Registro - Ra√≠z Digital{% endblock %}

{% block extra_css %}
<!-- üîß CARGAR VARIABLES CSS PRIMERO SIEMPRE -->
<link rel="stylesheet" href="{% static 'core/css/variables.css' %}?v={{ "now"|date:"U" }}">

<!-- ‚ú® LIBRER√çAS PROFESIONALES PREMIUM ‚ú® -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>

<!-- üîß ESTILOS CR√çTICOS INLINE PARA M√ìVIL - FALLBACK SI NO CARGAN ARCHIVOS EXTERNOS -->
<style>
    /* üî• FALLBACK CR√çTICO: Si los archivos CSS externos no cargan, usar estos estilos m√≠nimos */
    :root {
        --neon-green: #00ff9d;
        --neon-green-subtle: #00e085;
        --neon-green-soft: rgba(0, 255, 157, 0.8);
        --neon-green-glow: rgba(0, 255, 157, 0.3);
        
        --gradient-primary: linear-gradient(135deg, #00e085 0%, #00ff9d 100%);
        --gradient-secondary: linear-gradient(135deg, #4a90e2 0%, #667eea 100%);
        --gradient-accent: linear-gradient(135deg, #151718 0%, #030303 100%);
        --gradient-bg: linear-gradient(135deg, #0c0c26 0%, #1a1a3e 50%, #2d1b69 100%);
        
        --color-primary: #00ff9d;
        --color-secondary: #4a90e2;
        --color-accent: #667eea;
        --color-success: #00e085;
        --color-warning: #f0d969;
        --color-danger: #ec3e3e;
        
        --bg-glass: rgba(255, 255, 255, 0.08);
        --bg-glass-hover: rgba(255, 255, 255, 0.12);
        --border-glass: rgba(255, 255, 255, 0.15);
        --text-primary: #ffffff;
        --text-secondary: rgba(0, 255, 157, 0.8);
        --text-muted: rgba(255, 255, 255, 0.6);
        
        --shadow-glass: 0 8px 32px rgba(0, 0, 0, 0.3);
        --shadow-button: 0 4px 15px rgba(0, 255, 157, 0.3);
        --shadow-hover: 0 8px 25px rgba(0, 255, 157, 0.5);
        
        --radius-card: 24px;
        --radius-input: 16px;
        --radius-button: 12px;
        
        --font-heading: 'SF Pro Display', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
        --font-body: 'SF Pro Text', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    }

    /* üî• RESET B√ÅSICO */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    /* üî• BASE CR√çTICA PARA M√ìVIL */
    html, body {
        width: 100%;
        min-height: 100vh;
        overflow-x: hidden;
        overflow-y: auto;
        font-family: var(--font-body);
        background: var(--gradient-bg);
        color: var(--text-primary);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
    }

    /* üî• CONTAINER PRINCIPAL B√ÅSICO */
    .page-container {
        min-height: 100vh;
        width: 100%;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 2rem 1rem;
        position: relative;
        z-index: 10;
        max-width: 450px;
        margin: 0 auto;
    }

    /* üî• CONTENEDOR DEL FORMULARIO B√ÅSICO */
    .register-container {
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(25px);
        -webkit-backdrop-filter: blur(25px);
        border-radius: var(--radius-card);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: var(--shadow-glass);
        overflow: visible;
        position: relative;
        width: 100%;
        max-width: 360px;
        margin: 0 auto;
    }

    .register-content {
        position: relative;
        padding: 1.8rem 1.5rem;
        background: linear-gradient(145deg, 
            rgba(255, 255, 255, 0.1) 0%, 
            rgba(255, 255, 255, 0.05) 50%,
            rgba(255, 255, 255, 0.08) 100%);
        border-radius: calc(var(--radius-card) - 2px);
    }

    /* üî• HEADER B√ÅSICO */
    .register-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .app-icon {
        width: 70px;
        height: 70px;
        background: var(--gradient-primary);
        border-radius: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.2rem;
        box-shadow: var(--shadow-button);
        border: 2px solid var(--neon-green);
    }

    .app-icon svg {
        width: 35px;
        height: 35px;
        fill: white;
    }

    .register-title {
        font-family: var(--font-heading);
        font-size: 2rem;
        font-weight: 800;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 0.4rem;
        letter-spacing: -0.5px;
    }

    .register-subtitle {
        color: var(--text-secondary);
        font-size: 0.9rem;
        font-weight: 400;
    }

    /* üî• FORMULARIO B√ÅSICO */
    .register-form {
        display: flex;
        flex-direction: column;
        gap: 1.2rem;
    }

    .form-group {
        position: relative;
    }

    .form-label {
        color: var(--text-primary);
        display: block;
        margin-bottom: 0.75rem;
        font-size: 0.875rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .form-label.required::after {
        content: ' *';
        color: var(--color-danger);
        margin-left: 2px;
    }

    .input-wrapper {
        position: relative;
    }

    .form-input, .form-select {
        width: 100%;
        padding: 0.9rem 1rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: var(--radius-input);
        color: var(--text-primary);
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(15px);
        outline: none;
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .form-input:focus, .form-select:focus {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(0, 255, 157, 0.5);
        box-shadow: 0 0 0 3px rgba(0, 255, 157, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }

    .form-input::placeholder {
        color: var(--text-muted);
    }

    /* üî• SELECT PERSONALIZADO */
    .form-select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%2300ff9d' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 1rem center;
        background-size: 18px;
        cursor: pointer;
    }

    /* üî• BOT√ìN PRINCIPAL */
    .btn-submit {
        position: relative;
        width: 100%;
        padding: 1.1rem;
        background: linear-gradient(135deg, rgba(0, 255, 157, 0.8) 0%, rgba(0, 224, 133, 0.9) 100%);
        color: white;
        border: 1px solid rgba(0, 255, 157, 0.4);
        border-radius: var(--radius-button);
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: var(--shadow-button);
        margin-top: 0.3rem;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .btn-submit:hover {
        background: linear-gradient(135deg, rgba(0, 255, 157, 0.9) 0%, rgba(0, 224, 133, 1) 100%);
        box-shadow: var(--shadow-hover);
        transform: translateY(-2px);
    }

    /* üî• BOT√ìN VOLVER */
    .back-button {
        position: absolute;
        top: -80px;
        left: 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.875rem 1.25rem;
        background: var(--bg-glass);
        backdrop-filter: blur(10px);
        border: 1px solid var(--border-glass);
        border-radius: var(--radius-button);
        color: var(--text-primary);
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 600;
        transition: all 0.3s ease;
        z-index: 20;
    }

    .back-icon {
        width: 18px;
        height: 18px;
        fill: currentColor;
    }

    .back-button:hover {
        background: var(--bg-glass-hover);
        transform: translateY(-2px);
    }

    /* üî• MENSAJES DE ERROR/√âXITO */
    .error-messages, .success-message {
        padding: 1.25rem;
        border-radius: var(--radius-input);
        margin-bottom: 1.5rem;
        backdrop-filter: blur(10px);
        border: 1px solid;
    }

    .error-messages {
        background: rgba(240, 65, 65, 0.1);
        border-color: rgba(240, 65, 65, 0.3);
        color: #fca5a5;
    }

    .success-message {
        background: rgba(0, 224, 133, 0.1);
        border-color: rgba(0, 224, 133, 0.3);
        color: var(--neon-green);
    }

    .error-messages ul {
        list-style: none;
        margin: 0;
        padding: 0;
    }

    .error-messages li {
        margin-bottom: 0.5rem;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .error-messages li::before {
        content: '‚ö†Ô∏è';
        font-size: 1rem;
    }

    /* üî• INFORMACI√ìN DE VERIFICACI√ìN */
    .verification-info {
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(0, 255, 157, 0.3);
        border-radius: var(--radius-input);
        padding: 1.2rem;
        margin-top: 1.2rem;
        font-size: 0.85rem;
        color: var(--text-primary);
        line-height: 1.5;
        backdrop-filter: blur(15px);
    }

    .verification-info strong {
        color: var(--neon-green);
        font-weight: 700;
    }

    /* üî• ENLACES */
    .login-link {
        text-align: center;
        margin-top: 1.2rem;
        color: var(--text-secondary);
        font-size: 0.85rem;
    }

    .login-link a {
        color: var(--neon-green);
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .login-link a:hover {
        color: var(--neon-green-subtle);
    }

    /* üî• ESPEC√çFICO PARA M√ìVIL */
    @media (max-width: 480px) {
        html, body {
            overflow-y: auto !important;
            overflow-x: hidden !important;
            -webkit-overflow-scrolling: touch;
            -webkit-text-size-adjust: 100%;
        }

        .page-container {
            padding: 1rem 0.5rem;
            min-height: 100vh;
            padding-top: 2rem;
            padding-bottom: 3rem;
        }

        .register-container {
            max-width: 100%;
            width: 100%;
            border-radius: 16px;
        }

        .register-content {
            padding: 1.5rem 1rem;
        }

        .app-icon {
            width: 60px;
            height: 60px;
            margin-bottom: 1rem;
        }

        .app-icon svg {
            width: 30px;
            height: 30px;
        }

        .register-title {
            font-size: 1.8rem;
        }

        .register-subtitle {
            font-size: 0.85rem;
        }

        .form-input, .form-select {
            padding: 0.9rem;
            font-size: 16px; /* PREVENIR ZOOM EN SAFARI M√ìVIL */
        }

        .btn-submit {
            padding: 1rem;
            font-size: 0.95rem;
        }

        .back-button {
            top: -60px;
            padding: 0.6rem 0.8rem;
            font-size: 0.75rem;
        }

        .register-form {
            gap: 1rem;
        }

        .verification-info {
            padding: 1rem;
            margin-top: 1rem;
            margin-bottom: 1rem;
            font-size: 0.8rem;
        }

        .login-link {
            margin-top: 1rem;
            margin-bottom: 2rem;
        }
    }

    /* üî• CAMPO FECHA ESPEC√çFICO PARA M√ìVIL */
    input[type="date"].form-input {
        color-scheme: dark;
        position: relative;
        padding-right: 2.5rem;
    }

    input[type="date"].form-input::-webkit-calendar-picker-indicator {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='%2300ff9d'%3E%3Cpath d='M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z'/%3E%3C/svg%3E");
        background-size: 16px 16px;
        background-repeat: no-repeat;
        background-position: center;
        width: 24px;
        height: 24px;
        cursor: pointer;
        opacity: 0.8;
        transition: all 0.3s ease;
        filter: drop-shadow(0 0 4px rgba(0, 255, 157, 0.5));
        position: absolute;
        right: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
    }

    @media (max-width: 768px) {
        input[type="date"].form-input {
            padding-right: 3rem;
            font-size: 16px;
        }
        
        input[type="date"].form-input::-webkit-calendar-picker-indicator {
            width: 28px;
            height: 28px;
            background-size: 20px 20px;
            right: 0.5rem;
        }
    }

    /* üî• EFECTOS FLOATING SIMPLES */
    .floating-elements {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        pointer-events: none;
        overflow: hidden;
    }

    .floating-circle {
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.1;
        animation: float 20s ease-in-out infinite;
    }

    .floating-circle:nth-child(1) {
        width: 350px;
        height: 350px;
        background: var(--gradient-primary);
        top: -20%;
        left: -10%;
        animation-delay: 0s;
    }

    .floating-circle:nth-child(2) {
        width: 280px;
        height: 280px;
        background: var(--gradient-secondary);
        top: 50%;
        right: -15%;
        animation-delay: -7s;
    }

    .floating-circle:nth-child(3) {
        width: 220px;
        height: 220px;
        background: var(--gradient-accent);
        bottom: -10%;
        left: 30%;
        animation-delay: -14s;
    }

    @keyframes float {
        0%, 100% { 
            transform: translateY(0px) translateX(0px) scale(1); 
            opacity: 0.1;
        }
        25% { 
            transform: translateY(-15px) translateX(10px) scale(1.02); 
            opacity: 0.15;
        }
        50% { 
            transform: translateY(-8px) translateX(-8px) scale(0.98); 
            opacity: 0.2;
        }
        75% { 
            transform: translateY(-20px) translateX(15px) scale(1.03); 
            opacity: 0.12;
        }
    }

    /* üî• BORDE GRADIENTE ANIMADO */
    .register-border {
        position: absolute;
        inset: -1px;
        border-radius: calc(var(--radius-card) + 1px);
        background: linear-gradient(45deg, 
            rgba(255, 255, 255, 0.3), 
            rgba(0, 255, 157, 0.2), 
            rgba(255, 255, 255, 0.25),
            rgba(0, 255, 157, 0.15));
        background-size: 300% 300%;
        z-index: -1;
        animation: gradientRotate 20s ease-in-out infinite;
        opacity: 0.3;
    }

    @keyframes gradientRotate {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    /* üî• ESTADOS DE VALIDACI√ìN */
    .form-input.valid {
        border-color: var(--neon-green);
        box-shadow: 0 0 0 4px var(--neon-green-glow);
    }

    .form-input.invalid {
        border-color: var(--color-danger);
        box-shadow: 0 0 0 4px rgba(240, 65, 65, 0.2);
    }

    /* üî• EFECTO LOADING EN BOT√ìN */
    .btn-submit.loading {
        color: transparent;
        pointer-events: none;
    }

    .btn-submit.loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 24px;
        height: 24px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top: 2px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: translate(-50%, -50%) rotate(0deg); }
        100% { transform: translate(-50%, -50%) rotate(360deg); }
    }

    /* üî• DESACTIVAR ANIMACIONES PESADAS EN M√ìVIL PARA MEJORAR RENDIMIENTO */
    @media (max-width: 768px) {
        .floating-circle {
            animation-duration: 30s;
            opacity: 0.05;
        }
        
        .register-border {
            animation-duration: 30s;
            opacity: 0.2;
        }
        
        .form-input:focus, .form-select:focus {
            transform: none;
        }
    }

    /* üî• REDUCIR ANIMACIONES SI EL USUARIO LO PREFIERE */
    @media (prefers-reduced-motion: reduce) {
        .floating-circle,
        .register-border {
            animation: none !important;
        }
        
        .form-input:focus {
            transform: none !important;
        }
        
        .btn-submit:hover {
            transform: none !important;
        }
    }
</style>

<!-- üîß CARGAR CSS EXTERNO DESPU√âS DEL FALLBACK - CON CACHE BUSTING -->
<link rel="stylesheet" href="{% static 'core/css/register.css' %}?v={{ "now"|date:"U" }}" media="all">
{% endblock %}

{% block content %}
<!-- üåà ELEMENTOS FLOTANTES DE FONDO -->
<div class="floating-elements">
    <div class="floating-circle"></div>
    <div class="floating-circle"></div>
    <div class="floating-circle"></div>
</div>

<div class="page-container">
    <div class="register-container">
        <!-- Bot√≥n volver -->
        <a href="{% url 'core:login' %}" class="back-button">
            <svg class="back-icon" viewBox="0 0 24 24">
                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
            </svg>
            <span>Volver al Login</span>
        </a>

        <div class="register-border"></div>
        <div class="register-content">
            <!-- Header con √≠cono de app verde ne√≥n -->
            <div class="register-header">
                <div class="app-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"/>
                        <path d="M12 4.5c-4.136 0-7.5 3.364-7.5 7.5s3.364 7.5 7.5 7.5 7.5-3.364 7.5-7.5-3.364-7.5-7.5-7.5zm0 14c-3.584 0-6.5-2.916-6.5-6.5s2.916-6.5 6.5-6.5 6.5 2.916 6.5 6.5-2.916 6.5-6.5 6.5z"/>
                        <circle cx="12" cy="12" r="2.5"/>
                    </svg>
                </div>
                <h2 class="register-title">Crear Cuenta</h2>
                <p class="register-subtitle">√önete a la comunidad digital de tradiciones</p>
            </div>

            <!-- MENSAJES DE ERROR Y √âXITO -->
            {% if errors %}
            <div class="error-messages">
                <ul>
                    {% for error in errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if messages %}
                {% for message in messages %}
                    {% if message.tags == 'success' %}
                        <div class="success-message">
                            {{ message }}
                        </div>
                    {% endif %}
                {% endfor %}
            {% endif %}

            <form class="register-form" method="post" action="{% url 'core:register' %}" novalidate>
                {% csrf_token %}
                
                <!-- Nombre -->
                <div class="form-group">
                    <label class="form-label required">Nombre</label>
                    <div class="input-wrapper">
                        <input type="text" class="form-input" name="nombre" 
                               value="{{ form_data.nombre|default:'' }}" 
                               placeholder="Tu nombre" required>
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Apellido -->
                <div class="form-group">
                    <label class="form-label required">Apellido</label>
                    <div class="input-wrapper">
                        <input type="text" class="form-input" name="apellido" 
                               value="{{ form_data.apellido|default:'' }}" 
                               placeholder="Tu apellido" required>
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Usuario -->
                <div class="form-group">
                    <label class="form-label required">Usuario</label>
                    <div class="input-wrapper">
                        <input type="text" class="form-input" name="username" 
                               value="{{ form_data.username|default:'' }}" 
                               placeholder="Nombre de usuario √∫nico" required>
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Email -->
                <div class="form-group">
                    <label class="form-label required">Email</label>
                    <div class="input-wrapper">
                        <input type="email" class="form-input" name="email" 
                               value="{{ form_data.email|default:'' }}" 
                               placeholder="tu@email.com" required>
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Contrase√±a -->
                <div class="form-group">
                    <label class="form-label required">Contrase√±a</label>
                    <div class="input-wrapper">
                        <input type="password" class="form-input" name="password" 
                               placeholder="M√≠nimo 8 caracteres" required>
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Confirmar Contrase√±a -->
                <div class="form-group">
                    <label class="form-label required">Confirmar Contrase√±a</label>
                    <div class="input-wrapper">
                        <input type="password" class="form-input" name="password_confirm" 
                               placeholder="Repite tu contrase√±a" required>
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Fecha de Nacimiento -->
                <div class="form-group">
                    <label class="form-label">Fecha de Nacimiento</label>
                    <div class="input-wrapper">
                        <input type="date" class="form-input" name="fecha_nacimiento"
                               value="{{ form_data.fecha_nacimiento|default:'' }}">
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Tel√©fono -->
                <div class="form-group">
                    <label class="form-label">Tel√©fono</label>
                    <div class="input-wrapper">
                        <input type="tel" class="form-input" name="telefono" 
                               value="{{ form_data.telefono|default:'' }}" 
                               placeholder="+57 300 123 4567">
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Comunidad -->
                <div class="form-group">
                    <label class="form-label required">Comunidad</label>
                    <div class="input-wrapper">
                        <select class="form-select" name="id_comunidad" required>
                            <option value="">Selecciona tu comunidad</option>
                            {% for comunidad in comunidades %}
                            <option value="{{ comunidad.id }}" 
                                    {% if form_data.id_comunidad|default:'' == comunidad.id|stringformat:"s" %}selected{% endif %}>
                                {{ comunidad.display_name }}
                            </option>
                            {% endfor %}
                            {% if not comunidades %}
                            <option value="" disabled>No hay comunidades disponibles</option>
                            {% endif %}
                        </select>
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Direcci√≥n -->
                <div class="form-group">
                    <label class="form-label">Direcci√≥n</label>
                    <div class="input-wrapper">
                        <input type="text" class="form-input" name="direccion" 
                               value="{{ form_data.direccion|default:'' }}" 
                               placeholder="Tu direcci√≥n (opcional)">
                        <div class="input-effect"></div>
                    </div>
                </div>

                <!-- Biograf√≠a -->
                <div class="form-group">
                    <label class="form-label">Cu√©ntanos sobre ti</label>
                    <div class="input-wrapper">
                        <textarea class="form-input" name="biografia" rows="3" 
                                  placeholder="Breve descripci√≥n sobre ti y tus intereses en las tradiciones (opcional)">{{ form_data.biografia|default:'' }}</textarea>
                        <div class="input-effect"></div>
                    </div>
                </div>

                <button type="submit" class="btn-submit">
                    <span>Crear Mi Cuenta</span>
                </button>
            </form>

            <div class="verification-info">
                <strong>üìß Verificaci√≥n de Email:</strong><br>
                Despu√©s del registro, enviaremos un email de verificaci√≥n a tu correo. 
                Debes verificar tu cuenta para poder acceder completamente a la plataforma.
            </div>

            <div class="login-link">
                ¬øYa tienes una cuenta? <a href="{% url 'core:login' %}">Inicia sesi√≥n aqu√≠</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'core/js/digital-effects.js' %}?v={{ "now"|date:"U" }}"></script>

<!-- üîß SCRIPT CR√çTICO PARA DEBUG Y FUNCIONALIDAD M√ìVIL -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Registro - Versi√≥n CORREGIDA para m√≥vil iniciada');
    
    // üîß DEBUG: Verificar carga de archivos CSS
    const link = document.querySelector('link[href*="variables.css"]');
    if (link) {
        console.log('‚úÖ variables.css detectado:', link.href);
        
        // Verificar si se carg√≥ correctamente
        link.onload = function() {
            console.log('‚úÖ variables.css cargado exitosamente');
        };
        
        link.onerror = function() {
            console.log('‚ùå Error cargando variables.css');
            console.log('üîß Usando estilos inline de fallback');
        };
    } else {
        console.log('‚ùå variables.css NO encontrado');
    }
    
    // üîß DEBUG: Verificar estilos aplicados
    const testElement = document.querySelector('.register-container');
    if (testElement) {
        const styles = window.getComputedStyle(testElement);
        console.log('üé® Background del container:', styles.background);
        console.log('üé® Border radius:', styles.borderRadius);
        
        if (styles.background.includes('rgba') || styles.borderRadius !== '0px') {
            console.log('‚úÖ Estilos CSS aplicados correctamente');
        } else {
            console.log('‚ö†Ô∏è Estilos CSS no aplicados, usando fallback inline');
        }
    }
    
    // üîß OPTIMIZACIONES PARA M√ìVIL
    if (window.innerWidth <= 768) {
        console.log('üì± Modo m√≥vil detectado - aplicando optimizaciones');
        
        // Prevenir zoom en inputs
        const inputs = document.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.style.fontSize = '16px'; // Prevenir zoom en iOS
        });
        
        // Optimizar scroll
        document.body.style.webkitOverflowScrolling = 'touch';
        document.body.style.overscrollBehavior = 'none';
        
        // Prevenir pull-to-refresh
        let startY = 0;
        document.addEventListener('touchstart', function(e) {
            startY = e.touches[0].clientY;
        }, { passive: true });
        
        document.addEventListener('touchmove', function(e) {
            const currentY = e.touches[0].clientY;
            const scrollTop = window.scrollY;
            
            if (scrollTop <= 0 && currentY > startY) {
                e.preventDefault();
            }
        }, { passive: false });
    }
    
    // üîß SISTEMA DE VALIDACI√ìN MEJORADO
    const form = document.querySelector('.register-form');
    const inputs = form.querySelectorAll('.form-input, .form-select');
    const submitBtn = form.querySelector('.btn-submit');

    // Validaci√≥n en tiempo real
    inputs.forEach(input => {
        input.addEventListener('input', function() {
            validateField(this);
        });
        
        input.addEventListener('blur', function() {
            validateField(this);
        });
    });

    function validateField(field) {
        const value = field.value.trim();
        const fieldName = field.name;
        let isValid = true;

        field.classList.remove('valid', 'invalid');

        if (value.length === 0) {
            return true; // Campo vac√≠o - no mostrar validaci√≥n
        }

        switch(fieldName) {
            case 'nombre':
            case 'apellido':
                isValid = value.length >= 2;
                break;
            case 'username':
                isValid = value.length >= 3 && /^[a-zA-Z0-9_]+$/.test(value);
                break;
            case 'email':
                isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
                break;
            case 'password':
                isValid = value.length >= 8;
                break;
            case 'password_confirm':
                const password = document.querySelector('input[name="password"]').value;
                isValid = value === password;
                break;
        }

        if (isValid) {
            field.classList.add('valid');
        } else {
            field.classList.add('invalid');
        }

        return isValid;
    }

    // üîß MANEJO DEL ENV√çO DEL FORMULARIO
    if (form) {
        form.addEventListener('submit', function(e) {
            console.log('üìù Enviando formulario...');
            
            // Validar campos requeridos
            const requiredFields = form.querySelectorAll('input[required], select[required]');
            let allValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('invalid');
                    allValid = false;
                }
            });
            
            if (!allValid) {
                e.preventDefault();
                showNotification('Por favor, completa todos los campos obligatorios', 'error');
                return;
            }
            
            // Validar contrase√±as
            const password = document.querySelector('input[name="password"]').value;
            const confirmPassword = document.querySelector('input[name="password_confirm"]').value;
            
            if (password !== confirmPassword) {
                e.preventDefault();
                showNotification('Las contrase√±as no coinciden', 'error');
                return;
            }
            
            if (password.length < 8) {
                e.preventDefault();
                showNotification('La contrase√±a debe tener al menos 8 caracteres', 'error');
                return;
            }
            
            // Agregar loading al bot√≥n
            if (submitBtn) {
                submitBtn.classList.add('loading');
                submitBtn.disabled = true;
            }
            
            console.log('‚úÖ Formulario v√°lido, enviando...');
        });
    }

    // üîß SISTEMA DE NOTIFICACIONES
    function showNotification(message, type = 'info') {
        // Remover notificaciones existentes
        const existing = document.querySelectorAll('.notification');
        existing.forEach(n => n.remove());
        
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <div class="notification-icon">${getNotificationIcon(type)}</div>
                <span>${message}</span>
            </div>
        `;
        
        notification.style.cssText = `
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 16px;
            font-weight: 600;
            z-index: 9999;
            max-width: 400px;
            backdrop-filter: blur(20px);
            border: 1px solid;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transform: translateX(100%);
            transition: transform 0.4s ease;
        `;
        
        if (type === 'error') {
            notification.style.background = 'rgba(240, 65, 65, 0.9)';
            notification.style.color = 'white';
            notification.style.borderColor = '#f04141';
        } else if (type === 'success') {
            notification.style.background = 'rgba(0, 224, 133, 0.9)';
            notification.style.color = 'white';
            notification.style.borderColor = '#00ff9d';
        }
        
        // Ajustar para m√≥vil
        if (window.innerWidth <= 768) {
            notification.style.top = '1rem';
            notification.style.right = '1rem';
            notification.style.left = '1rem';
            notification.style.maxWidth = 'none';
        }
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.transform = 'translateX(0)';
        }, 100);
        
        setTimeout(() => {
            notification.style.transform = 'translateX(100%)';
            setTimeout(() => notification.remove(), 400);
        }, 4000);
    }

    function getNotificationIcon(type) {
        switch(type) {
            case 'error': return '‚ö†Ô∏è';
            case 'success': return '‚úÖ';
            default: return 'üíö';
        }
    }

    // üîß CARGAR LIBRER√çAS EXTERNAS DE FORMA SEGURA
    function loadExternalLibraries() {
        // AOS - Animaciones
        if (typeof AOS !== 'undefined' && window.innerWidth > 768) {
            try {
                AOS.init({
                    duration: 600,
                    easing: 'ease-out-cubic',
                    once: true,
                    offset: 30,
                    disable: window.innerWidth <= 768
                });
                console.log('‚úÖ AOS inicializado');
            } catch (error) {
                console.log('‚ö†Ô∏è Error inicializando AOS:', error);
            }
        }

        // GSAP - Animaciones avanzadas
        if (typeof gsap !== 'undefined' && window.innerWidth > 768) {
            try {
                gsap.config({
                    force3D: true,
                    nullTargetWarn: false
                });

                // Animaci√≥n sutil del contenedor
                gsap.fromTo('.register-container', 
                    { scale: 0.98, opacity: 0, y: 20 },
                    { scale: 1, opacity: 1, y: 0, duration: 0.6, ease: "power2.out" }
                );

                console.log('‚úÖ GSAP inicializado');
            } catch (error) {
                console.log('‚ö†Ô∏è Error inicializando GSAP:', error);
            }
        }
    }

    // Cargar librer√≠as despu√©s de un breve delay
    setTimeout(loadExternalLibraries, 500);

    // üîß FIELD FOCUS MEJORADO PARA M√ìVIL
    inputs.forEach(input => {
        input.addEventListener('focus', function() {
            // Scroll suave al campo en m√≥vil
            if (window.innerWidth <= 768) {
                setTimeout(() => {
                    this.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center',
                        inline: 'nearest'
                    });
                }, 300); // Delay para que el teclado aparezca
            }
        });
    });

    // üîß MANEJO DE ORIENTACI√ìN EN M√ìVIL
    window.addEventListener('orientationchange', function() {
        setTimeout(() => {
            // Re-optimizar despu√©s del cambio de orientaci√≥n
            if (window.innerWidth <= 768) {
                document.body.style.height = 'auto';
                window.scrollTo(0, 0);
            }
        }, 200);
    });

    console.log('‚ú® Registro m√≥vil - Inicializaci√≥n completa');
});

// üîß SCRIPT PARA DETECTAR PROBLEMAS DE CARGA CSS
window.addEventListener('load', function() {
    const cssLoaded = Array.from(document.styleSheets).some(sheet => {
        try {
            return sheet.href && sheet.href.includes('variables.css');
        } catch (e) {
            return false;
        }
    });
    
    if (cssLoaded) {
        console.log('‚úÖ CSS externo cargado correctamente');
    } else {
        console.log('‚ö†Ô∏è CSS externo no detectado - usando estilos inline');
    }
    
    // Test final de estilos
    const container = document.querySelector('.register-container');
    if (container) {
        const bgColor = window.getComputedStyle(container).backgroundColor;
        if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
            console.log('‚úÖ Estilos aplicados correctamente');
        } else {
            console.log('‚ùå Estilos no aplicados - problema con archivos CSS');
        }
    }
});
</script>

{% if success %}
{% include 'core/includes/success_modal.html' %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const userData = {
        username: '{{ form_data.username|default:"" }}',
        email: '{{ form_data.email|default:"" }}'
    };
    
    // Mostrar el modal autom√°ticamente
    if (window.showEpicSuccessModal) {
        window.showEpicSuccessModal({
            title: "¬°REGISTRO EXITOSO!",
            subtitle: "Bienvenido a Ra√≠z Digital",
            message: "Tu cuenta ha sido creada exitosamente para " + userData.username + ".",
            verificationText: "Hemos enviado un enlace de verificaci√≥n a " + userData.email + ". Por favor revisa tu bandeja de entrada."
        });
    }
});
</script>
{% endif %}
{% endblock %}