<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Ra√≠z Digital{% endblock %}</title>
    {% load static %}

    <!-- Estilos base -->
    <link rel="stylesheet" href="{% static 'core/css/variables.css' %}">

    <!-- Estilos del men√∫ de navegaci√≥n modular (cargamos siempre para accesibilidad) -->
    <link rel="stylesheet" href="{% static 'core/css/menu_nav.css' %}">

    <style>
        :root {
            --neon-green: #00ff9d;
            --cyber-blue: #00f6ff;
            --dark-blue: #041222;
            --dark-green: #051f17;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* SOLUCI√ìN SIMPLE Y EFECTIVA PARA EL OVERSCROLL */
        html {
            /* Fondo que cubra toda la p√°gina incluyendo √°reas de overscroll */
            background: linear-gradient(135deg, var(--dark-blue) 0%, #061826 50%, var(--dark-green) 100%);
            background-attachment: fixed;
            min-height: 100%;
        }

        body {
            background: linear-gradient(135deg, var(--dark-blue) 0%, #061826 50%, var(--dark-green) 100%);
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            color: white;
            /* Solo prevenir overscroll horizontal, mantener vertical funcional */
            overscroll-behavior-x: none;
        }

        /* Fondo extendido para cubrir √°reas de overscroll SIN afectar el scroll */
        body::before {
            content: '';
            position: fixed;
            top: -200px;
            left: 0;
            right: 0;
            height: calc(100vh + 400px);
            background: linear-gradient(135deg, var(--dark-blue) 0%, #061826 50%, var(--dark-green) 100%);
            z-index: -999;
            pointer-events: none;
        }

        /* Para dispositivos m√≥viles - ajuste espec√≠fico */
        @media screen and (max-width: 768px) {
            html {
                /* En m√≥viles usar background local para mejor rendimiento */
                background-attachment: local;
            }

            body {
                /* Extender altura m√≠nima solo ligeramente */
                min-height: calc(100vh + 100px);
            }

            /* Fondo extendido m√°s grande en m√≥viles */
            body::before {
                top: -300px;
                height: calc(100vh + 600px);
            }
        }

        canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Clase para cuando el men√∫ est√° presente */
        .has-menu .content-wrapper {
            padding-top: 70px;
            /* Espacio para el men√∫ */
        }

        /* Clase para cuando NO hay men√∫ */
        .no-menu .content-wrapper {
            padding-top: 0;
            /* Sin espacio extra */
        }

        @media (max-width: 768px) {
            .has-menu .content-wrapper {
                padding-top: 60px;
                /* Men√∫ m√≥vil m√°s peque√±o */
            }
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>

<body class="{% if request.resolver_match.url_name == 'index' %}no-menu{% else %}has-menu{% endif %}">
    <!-- Incluir el men√∫ de navegaci√≥n solo para p√°ginas que no sean las seleccionadas-->
    {% if request.resolver_match.url_name not in 'index,login,password_recovery,register,marketplace' %}
    {% include 'core/includes/menu_nav.html' %}
    {% endif %}

    <canvas id="backgroundCanvas"></canvas>
    <div class="content-wrapper">
        {% block content %}{% endblock %}
    </div>

    <!-- Scripts base -->
    <script>
        // Clase base para efectos de canvas
        class CanvasEffect {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.resize();
                window.addEventListener('resize', () => this.resize());
            }

            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }

            clear() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
            }
        }

        // Funci√≥n para verificar si el usuario est√° logueado
        function isUserLoggedIn() {
            // Verificar indicadores de sesi√≥n en la p√°gina
            return !!(
                document.querySelector('.user-info') ||
                document.querySelector('.mobile-nav-link.logout') ||
                document.body.classList.contains('has-menu') ||
                '{{ request.session.user_id }}' // Variable de sesi√≥n de Django
            );
        }

        // Variables globales para el sistema de logout
        window.userSessionData = {
            isLoggedIn: isUserLoggedIn(),
            userId: '{{ request.session.user_id|default:"" }}',
            username: '{{ request.session.username|default:"" }}',
            startTime: Date.now()
        };

        console.log('üîê Estado de sesi√≥n:', window.userSessionData);
    </script>

    <!-- Sistema de auto-logout SOLO para usuarios logueados -->
    {% if request.session.user_id %}
    <script src="{% static 'core/js/auto-logout.js' %}?v=1"></script>
    <script>
        // Configuraci√≥n espec√≠fica del auto-logout para Django
        document.addEventListener('DOMContentLoaded', function () {
            console.log('üïê Iniciando sistema de auto-logout para usuario {{ request.session.username }}');

            // Verificar que el usuario est√© realmente logueado
            if ('{{ request.session.user_id }}') {
                // Inicializar con configuraci√≥n personalizada
                if (typeof AutoLogoutSystem !== 'undefined') {
                    window.autoLogoutSystem = new AutoLogoutSystem({
                        timeout: 3 * 60 * 1000, // 3 minutos
                        warningTime: 30 * 1000, // Advertir 30 segundos antes
                        logoutUrl: '{% url "core:login" %}', // URL de Django para logout
                        checkInterval: 1000 // Verificar cada segundo
                    });

                    console.log('‚úÖ Auto-logout configurado para 3 minutos de inactividad');
                } else {
                    console.error('‚ùå AutoLogoutSystem no est√° disponible');
                }
            }
        });
    </script>
    {% endif %}

    {% block extra_js %}{% endblock %}
</body>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        let scrollTimeout;

        // Solo en dispositivos m√≥viles
        if (window.innerWidth <= 768) {
            // Mostrar indicador durante el scroll
            window.addEventListener('scroll', function () {
                document.body.classList.add('scrolling');

                // Ocultar despu√©s de 1 segundo de inactividad
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(function () {
                    document.body.classList.remove('scrolling');
                }, 1000);
            }, { passive: true });

            // Tambi√©n mostrar al hacer touch
            document.addEventListener('touchstart', function () {
                document.body.classList.add('scrolling');
            }, { passive: true });

            document.addEventListener('touchend', function () {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(function () {
                    document.body.classList.remove('scrolling');
                }, 1500);
            }, { passive: true });
        }
    });
</script>

</html>