{% extends 'core/base.html' %}
{% load static %}

{% block title %}{{ noticia.titulo }} - Raíz Digital{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/variables.css' %}?v=2">
<link rel="stylesheet" href="{% static 'core/css/news.css' %}?v=6">
<style>
    /* Estilos específicos para la página de detalle de noticia */
    .article-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 30px 20px;
        background: rgba(10, 25, 47, 0.7);
        backdrop-filter: blur(10px);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-soft);
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(0, 255, 157, 0.2);
    }

    .article-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(90deg, var(--neon-green), var(--cyber-blue), var(--neon-green));
        background-size: 200% 100%;
        animation: gradientMove 4s linear infinite;
    }

    .article-header {
        margin-bottom: 40px;
        text-align: center;
    }

    .article-category {
        display: inline-block;
        padding: 5px 15px;
        background: rgba(0, 255, 157, 0.1);
        color: var(--neon-green);
        border-radius: 30px;
        font-size: 0.8rem;
        font-weight: 600;
        margin-bottom: 20px;
        border: 1px solid rgba(0, 255, 157, 0.3);
    }

    .article-title {
        font-size: clamp(2rem, 5vw, 3rem);
        color: var(--news-light);
        margin-bottom: 20px;
        line-height: 1.2;
    }

    .article-meta {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 30px;
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.9rem;
    }

    .article-author {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .author-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-size: cover;
        background-position: center;
        border: 2px solid rgba(0, 255, 157, 0.3);
    }

    .article-date,
    .article-views {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .article-date svg,
    .article-views svg {
        width: 18px;
        height: 18px;
        fill: rgba(255, 255, 255, 0.6);
    }

    .article-featured-image {
        width: 100%;
        height: 400px;
        background-size: cover;
        background-position: center;
        margin-bottom: 30px;
        border-radius: 10px;
        overflow: hidden;
        position: relative;
    }

    .article-featured-image::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(0deg, rgba(10, 25, 47, 0.3), transparent);
    }

    .article-content {
        color: rgba(255, 255, 255, 0.9);
        line-height: 1.8;
        font-size: 1.1rem;
    }

    .article-content p {
        margin-bottom: 20px;
    }

    .article-content h2 {
        margin-top: 40px;
        margin-bottom: 20px;
        color: var(--news-light);
        font-size: 1.6rem;
    }

    .article-content h3 {
        margin-top: 30px;
        margin-bottom: 15px;
        color: var(--news-light);
        font-size: 1.3rem;
    }

    .article-content ul,
    .article-content ol {
        margin-bottom: 20px;
        padding-left: 20px;
    }

    .article-content li {
        margin-bottom: 10px;
    }

    .article-content a {
        color: var(--news-accent);
        text-decoration: underline;
        transition: var(--transition-smooth);
    }

    .article-content a:hover {
        color: var(--news-secondary);
    }

    .article-content img {
        max-width: 100%;
        border-radius: 8px;
        margin: 20px 0;
    }

    /* Sección de noticias relacionadas */
    .related-articles {
        margin-top: 50px;
        padding-top: 30px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .related-title {
        text-align: center;
        font-size: 1.5rem;
        color: var(--news-light);
        margin-bottom: 30px;
    }

    .related-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
    }

    .related-card {
        background: rgba(10, 25, 47, 0.4);
        border-radius: 8px;
        overflow: hidden;
        transition: var(--transition-smooth);
        border: 1px solid rgba(0, 255, 157, 0.1);
    }

    .related-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-accent);
        border-color: rgba(0, 255, 157, 0.3);
    }

    .related-image {
        height: 150px;
        background-size: cover;
        background-position: center;
    }

    .related-content {
        padding: 15px;
    }

    .related-card-title {
        font-size: 1rem;
        margin-bottom: 10px;
        color: var(--news-light);
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .related-date {
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.6);
    }

    /* Botones de compartir */
    .share-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin: 40px 0;
    }

    .share-button {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        transition: var(--transition-smooth);
        cursor: pointer;
    }

    .share-button svg {
        width: 20px;
        height: 20px;
        fill: rgba(255, 255, 255, 0.7);
        transition: var(--transition-smooth);
    }

    .share-button:hover {
        background: var(--news-accent);
    }

    .share-button:hover svg {
        fill: var(--news-dark);
    }

    /* Botones de navegación */
    .article-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 40px;
        margin-bottom: 20px;
    }

    .nav-button {
        display: flex;
        align-items: center;
        gap: 10px;
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        transition: var(--transition-smooth);
    }

    .nav-button svg {
        width: 24px;
        height: 24px;
        fill: rgba(255, 255, 255, 0.7);
        transition: var(--transition-smooth);
    }

    .nav-button:hover {
        color: var(--news-accent);
    }

    .nav-button:hover svg {
        fill: var(--news-accent);
    }

    /* Estilos para móviles */
    @media (max-width: 768px) {
        .article-meta {
            flex-direction: column;
            gap: 15px;
        }

        .article-featured-image {
            height: 250px;
        }

        .article-content {
            font-size: 1rem;
        }

        .related-grid {
            grid-template-columns: 1fr;
        }
    }

    @keyframes gradientMove {
        0% {
            background-position: 0% 0;
        }

        100% {
            background-position: 200% 0;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="news-container">
    <!-- Elementos de fondo -->
    <div class="news-background">
        <div class="cyber-grid"></div>
        <div class="organic-shapes">
            <div class="organic-shape shape1"></div>
            <div class="organic-shape shape2"></div>
        </div>
    </div>

    <!-- Barra de navegación superior -->
    <header class="news-header">
        <a href="{% url 'core:index' %}" class="news-logo">
            <svg viewBox="0 0 24 24">
                <path
                    d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z" />
                <path
                    d="M12 4.5c-4.136 0-7.5 3.364-7.5 7.5s3.364 7.5 7.5 7.5 7.5-3.364 7.5-7.5-3.364-7.5-7.5-7.5zm0 14c-3.584 0-6.5-2.916-6.5-6.5s2.916-6.5 6.5-6.5 6.5 2.916 6.5 6.5-2.916 6.5-6.5 6.5z" />
                <path
                    d="M12 7c-2.757 0-5 2.243-5 5s2.243 5 5 5 5-2.243 5-5-2.243-5-5-5zm0 9c-2.206 0-4-1.794-4-4s1.794-4 4-4 4 1.794 4 4-1.794 4-4 4z" />
                <circle cx="12" cy="12" r="2.5" />
            </svg>
            <span class="news-logo-text">Raíz Digital</span>
        </a>

        <nav class="news-nav">
            <a href="/marketplace/" class="nav-link">Inicio</a>
            <a href="{% url 'core:noticias' %}" class="nav-link active">Noticias</a>
            <a href="#" class="nav-link">Eventos</a>
            <a href="#" class="nav-link">Productos</a>
            <a href="#" class="nav-link">Comunidades</a>
        </nav>
    </header>

    <!-- Contenido principal -->
    <main class="news-content">
        <!-- Botón para volver -->
        <a href="{% url 'core:noticias' %}" class="back-button">
            <svg viewBox="0 0 24 24">
                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
            </svg>
            <span>Volver a Noticias</span>
        </a>

        {% if request.session.is_admin or is_admin %}
        <div class="admin-action-container" style="margin: 20px 0;">
            <a href="{% url 'core:editar_noticia' noticia.slug %}" class="btn-create-news">
                <svg viewBox="0 0 24 24" width="18" height="18">
                    <path
                        d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
                </svg>
                <span>Editar Noticia</span>
            </a>
        </div>
        {% endif %}

        <!-- Artículo completo -->
        <article class="article-container">
            <header class="article-header">
                <span class="article-category">Noticia</span>
                <h1 class="article-title">{{ noticia.titulo }}</h1>
                <div class="article-meta">
                    <div class="article-author">
                        <div class="author-avatar" style="background-color: #052016;"></div>
                        <span>{{ autor.nombre }}</span>
                    </div>
                    <div class="article-date">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z" />
                            <path d="M13 7h-2v5.414l3.293 3.293 1.414-1.414L13 11.586z" />
                        </svg>
                        <span>{{ noticia.fecha_publicacion|date:"d M, Y" }}</span>
                    </div>
                    <div class="article-views">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
                        </svg>
                        <span>{{ noticia.vistas }} lecturas</span>
                    </div>
                </div>
            </header>

            <!-- Imagen destacada -->
            <div class="article-featured-image"
                data-bg-url="{% if noticia.imagen_portada %}{% static 'core/img/news/'|add:noticia.imagen_portada %}{% else %}{% static 'core/img/news/default.jpg' %}{% endif %}">
            </div>

            <!-- Contenido del artículo -->
            <div class="article-content">
                {{ noticia.contenido|linebreaks }}
            </div>

            <!-- Botones para compartir -->
            <div class="share-buttons">
                <a class="share-button" title="Compartir en Facebook" href="javascript:void(0);"
                    onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(window.location.href), 'facebook-share', 'width=580,height=520'); return false;">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 2C6.477 2 2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.879V14.89h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.989C18.343 21.129 22 16.99 22 12c0-5.523-4.477-10-10-10z" />
                    </svg>
                </a>
                <a class="share-button" title="Compartir en Twitter" href="javascript:void(0);"
                    onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent('{{ noticia.titulo }}') + '&url=' + encodeURIComponent(window.location.href), 'twitter-share', 'width=580,height=520'); return false;">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M22 5.795c-.75.333-1.554.56-2.4.662.864-.515 1.529-1.332 1.843-2.305-.807.474-1.701.82-2.651 1.006C17.989 4.42 16.931 4 15.76 4c-2.234 0-4.045 1.791-4.045 4.005 0 .314.036.618.105.91-3.36-.168-6.341-1.757-8.335-4.177-.348.588-.547 1.272-.547 2 0 1.39.715 2.616 1.8 3.335-.664-.022-1.29-.2-1.836-.5v.05c0 1.942 1.394 3.562 3.242 3.93-.34.09-.696.14-1.066.14-.26 0-.514-.025-.76-.075.513 1.593 2 2.752 3.765 2.783-1.38 1.069-3.12 1.704-5.01 1.704-.326 0-.647-.018-.965-.056 1.785 1.131 3.903 1.79 6.18 1.79 7.413 0 11.464-6.072 11.464-11.337 0-.172-.004-.345-.012-.516.787-.562 1.468-1.264 2.01-2.063z" />
                    </svg>
                </a>
                <a class="share-button" title="Compartir por WhatsApp"
                    href="whatsapp://send?text={{ noticia.titulo }}%20-%20{{ request.build_absolute_uri }}"
                    data-action="share/whatsapp/share">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.582 2.128 2.182-.573c.978.58 1.911.928 3.145.929 3.178 0 5.767-2.587 5.768-5.766.001-3.187-2.575-5.77-5.764-5.771zm3.392 8.244c-.144.405-.837.774-1.17.824-.299.045-.677.063-1.092-.069-.252-.08-.575-.187-.988-.365-1.739-.751-2.874-2.502-2.961-2.617-.087-.116-.708-.94-.708-1.793s.448-1.273.607-1.446c.159-.173.346-.217.462-.217l.332.006c.106.005.249-.04.39.298.144.347.491 1.2.534 1.287.043.087.072.188.014.304-.058.116-.087.188-.173.289l-.26.304c-.087.086-.177.18-.076.354.101.174.449.741.964 1.201.662.591 1.221.774 1.394.86s.274.072.376-.043c.101-.116.433-.506.549-.68.116-.173.231-.145.39-.087s1.011.477 1.184.564c.173.087.288.131.332.202.043.72.043.433-.101.593z" />
                    </svg>
                </a>
                <button class="share-button" title="Copiar enlace" onclick="copyToClipboard(window.location.href)">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z" />
                    </svg>
                </button>
            </div>

            <!-- Noticias relacionadas -->
            {% if noticias_relacionadas %}
            <div class="related-articles">
                <h3 class="related-title">Noticias Relacionadas</h3>
                <div class="related-grid">
                    {% for noticia_rel in noticias_relacionadas %}
                    <a href="{% url 'core:noticia_detalle' noticia_rel.slug %}" class="related-card">
                        <div class="related-image"
                            data-bg-url="{% if noticia_rel.imagen_portada %}{% static 'core/img/news/'|add:noticia_rel.imagen_portada %}{% else %}{% static 'core/img/news/default.jpg' %}{% endif %}">
                        </div>
                        <div class="related-content">
                            <h4 class="related-card-title">{{ noticia_rel.titulo }}</h4>
                            <div class="related-date">{{ noticia_rel.fecha_publicacion|date:"d M, Y" }}</div>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Navegación entre artículos -->
            <div class="article-navigation">
                <a href="{% url 'core:noticias' %}" class="nav-button">
                    <svg viewBox="0 0 24 24">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                    </svg>
                    <span>Volver a Noticias</span>
                </a>
            </div>
        </article>
    </main>

    <!-- Botón para volver arriba -->
    <div class="back-to-top" id="backToTop">
        <svg viewBox="0 0 24 24">
            <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" />
        </svg>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Configuración del botón para volver arriba
        const backToTopButton = document.getElementById('backToTop');
        if (backToTopButton) {
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    backToTopButton.classList.add('visible');
                } else {
                    backToTopButton.classList.remove('visible');
                }
            });

            backToTopButton.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }

        // Establecer imágenes de fondo
        document.querySelectorAll('[data-bg-url]').forEach(function (element) {
            const bgUrl = element.getAttribute('data-bg-url');
            if (bgUrl) {
                element.style.backgroundImage = `url('${bgUrl}')`;
            } else {
                element.style.backgroundImage = `url('{% static 'core/img/news/default.jpg' %}')`;
            }
        });

        // Función para copiar enlace al portapapeles
        window.copyToClipboard = function (text) {
            const tempInput = document.createElement('input');
            tempInput.value = text;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);

            // Mostrar notificación de copiado
            const notification = document.createElement('div');
            notification.textContent = '¡Enlace copiado!';
            notification.style.cssText = `
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--neon-green);
            color: var(--dark-matter);
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0, 255, 157, 0.3);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '1';
            }, 100);

            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        };

        // Animación para el contenido
        const articleContent = document.querySelector('.article-content');
        if (articleContent) {
            const paragraphs = articleContent.querySelectorAll('p, h2, h3, ul, ol, img');
            paragraphs.forEach((paragraph, index) => {
                paragraph.style.opacity = '0';
                paragraph.style.transform = 'translateY(20px)';
                paragraph.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                paragraph.style.transitionDelay = `${0.1 + (index * 0.05)}s`;

                setTimeout(() => {
                    paragraph.style.opacity = '1';
                    paragraph.style.transform = 'translateY(0)';
                }, 100);
            });
        }

        // Animación para las noticias relacionadas
        const relatedCards = document.querySelectorAll('.related-card');
        relatedCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            card.style.transitionDelay = `${0.3 + (index * 0.1)}s`;

            setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 100);
        });

        // Efecto parallax suave para la imagen destacada
        const featuredImage = document.querySelector('.article-featured-image');
        if (featuredImage) {
            window.addEventListener('scroll', () => {
                const scrollPosition = window.scrollY;
                if (scrollPosition < 600) { // Solo aplicar efecto en la parte superior
                    const parallaxOffset = scrollPosition * 0.15;
                    featuredImage.style.backgroundPosition = `center calc(50% + ${parallaxOffset}px)`;
                }
            });
        }
    });
</script>
{% endblock %}